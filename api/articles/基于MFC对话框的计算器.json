{"title":"基于MFC对话框的计算器","slug":"基于MFC对话框的计算器","date":"2017-10-30T14:50:44.000Z","updated":"2018-04-23T14:01:58.000Z","comments":true,"path":"api/articles/基于MFC对话框的计算器.json","excerpt":null,"covers":["http://tysb7.cn/wp-content/uploads/2017/10/QQ截图20171030204944.png"],"content":"<h2 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h2><p>最近开始学习MFC，第一个项目就是计算器。</p>\n<h2 id=\"效果\"><a href=\"#效果\" class=\"headerlink\" title=\"效果\"></a>效果</h2><p><img src=\"http://tysb7.cn/wp-content/uploads/2017/10/QQ截图20171030204944.png\" alt=\"Markdown\"></p>\n<h2 id=\"CalculatorDlg-h\"><a href=\"#CalculatorDlg-h\" class=\"headerlink\" title=\"CalculatorDlg.h\"></a>CalculatorDlg.h</h2><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// CalculatorDlg.h: 头文件</span></span><br><span class=\"line\"><span class=\"comment\">//</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">pragma</span> once</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">enum</span> CALCULATOR_FLAG &#123;</span><br><span class=\"line\">\tFLAG_JIA = <span class=\"number\">0</span>,</span><br><span class=\"line\">\tFLAG_JIAN,</span><br><span class=\"line\">\tFLAG_CHENG,</span><br><span class=\"line\">\tFLAG_CHU,</span><br><span class=\"line\">\tFLAG_PINGFANG,</span><br><span class=\"line\">\tFLAG_KAIFANG,</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// CCalculatorDlg 对话框</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CCalculatorDlg</span> :</span> <span class=\"keyword\">public</span> CDialog</span><br><span class=\"line\">&#123;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//class CCalculatorDlg : public CDialogEx</span></span><br><span class=\"line\"><span class=\"comment\">//&#123;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 构造</span></span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">\tCCalculatorDlg(CWnd* pParent = <span class=\"literal\">NULL</span>);\t<span class=\"comment\">// 标准构造函数</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 对话框数据</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">ifdef</span> AFX_DESIGN_TIME</span></span><br><span class=\"line\">\t<span class=\"keyword\">enum</span> &#123; IDD = IDD_CALCULATOR_DIALOG &#125;;</span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">endif</span></span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">SaveFirstValue</span><span class=\"params\">()</span></span>;      <span class=\"comment\">//保存第一个输入值  </span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">Calculator</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">\t<span class=\"keyword\">protected</span>:</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">virtual</span> <span class=\"keyword\">void</span> <span class=\"title\">DoDataExchange</span><span class=\"params\">(CDataExchange* pDX)</span></span>;\t<span class=\"comment\">// DDX/DDV 支持</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 实现</span></span><br><span class=\"line\"><span class=\"keyword\">protected</span>:</span><br><span class=\"line\">\tHICON m_hIcon;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// 生成的消息映射函数</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">virtual</span> BOOL <span class=\"title\">OnInitDialog</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">\t<span class=\"function\">afx_msg <span class=\"keyword\">void</span> <span class=\"title\">OnSysCommand</span><span class=\"params\">(UINT nID, LPARAM lParam)</span></span>;</span><br><span class=\"line\">\t<span class=\"function\">afx_msg <span class=\"keyword\">void</span> <span class=\"title\">OnPaint</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">\t<span class=\"function\">afx_msg HCURSOR <span class=\"title\">OnQueryDragIcon</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">\tDECLARE_MESSAGE_MAP()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">\t</span><br><span class=\"line\">\tCString mStr;</span><br><span class=\"line\">\t<span class=\"function\">afx_msg <span class=\"keyword\">void</span> <span class=\"title\">OnBnClickedButton1</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">\t<span class=\"function\">afx_msg <span class=\"keyword\">void</span> <span class=\"title\">OnBnClickedButton2</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">\t<span class=\"function\">afx_msg <span class=\"keyword\">void</span> <span class=\"title\">OnBnClickedButton3</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">\t<span class=\"function\">afx_msg <span class=\"keyword\">void</span> <span class=\"title\">OnBnClickedButton4</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">\t<span class=\"function\">afx_msg <span class=\"keyword\">void</span> <span class=\"title\">OnBnClickedButton5</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">\t<span class=\"function\">afx_msg <span class=\"keyword\">void</span> <span class=\"title\">OnBnClickedButton6</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">\t<span class=\"function\">afx_msg <span class=\"keyword\">void</span> <span class=\"title\">OnBnClickedButton7</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">\t<span class=\"function\">afx_msg <span class=\"keyword\">void</span> <span class=\"title\">OnBnClickedButton8</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">\t<span class=\"function\">afx_msg <span class=\"keyword\">void</span> <span class=\"title\">OnBnClickedButton9</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">\t<span class=\"function\">afx_msg <span class=\"keyword\">void</span> <span class=\"title\">OnBnClickedButton0</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">\t<span class=\"function\">afx_msg <span class=\"keyword\">void</span> <span class=\"title\">OnBnClickedButtonDian</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">\t<span class=\"function\">afx_msg <span class=\"keyword\">void</span> <span class=\"title\">OnBnClickedButtonJia</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">\t<span class=\"function\">afx_msg <span class=\"keyword\">void</span> <span class=\"title\">OnBnClickedButtonJian</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">\t<span class=\"function\">afx_msg <span class=\"keyword\">void</span> <span class=\"title\">OnBnClickedButtonCheng</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">\t<span class=\"function\">afx_msg <span class=\"keyword\">void</span> <span class=\"title\">OnBnClickedButtonChu</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">\t<span class=\"function\">afx_msg <span class=\"keyword\">void</span> <span class=\"title\">OnBnClickedButtonDeng</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">\t<span class=\"function\">afx_msg <span class=\"keyword\">void</span> <span class=\"title\">OnBnClickedButtonClear</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">\t<span class=\"function\">afx_msg <span class=\"keyword\">void</span> <span class=\"title\">OnBnClickedButtonBack</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">\t</span><br><span class=\"line\"><span class=\"keyword\">private</span>:</span><br><span class=\"line\">\t<span class=\"comment\">//编辑框内的字符串  </span></span><br><span class=\"line\">\t<span class=\"comment\">//输入的2个值    </span></span><br><span class=\"line\">\t<span class=\"keyword\">double</span> mNum1;</span><br><span class=\"line\">\t<span class=\"keyword\">double</span> mNum2;</span><br><span class=\"line\">\t<span class=\"comment\">//运算符号  </span></span><br><span class=\"line\">\tCALCULATOR_FLAG mFlag;</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">\t<span class=\"function\">afx_msg <span class=\"keyword\">void</span> <span class=\"title\">OnEnChangeEdit1</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<h2 id=\"CalculatorDlg-cpp\"><a href=\"#CalculatorDlg-cpp\" class=\"headerlink\" title=\"CalculatorDlg.cpp\"></a>CalculatorDlg.cpp</h2><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br><span class=\"line\">245</span><br><span class=\"line\">246</span><br><span class=\"line\">247</span><br><span class=\"line\">248</span><br><span class=\"line\">249</span><br><span class=\"line\">250</span><br><span class=\"line\">251</span><br><span class=\"line\">252</span><br><span class=\"line\">253</span><br><span class=\"line\">254</span><br><span class=\"line\">255</span><br><span class=\"line\">256</span><br><span class=\"line\">257</span><br><span class=\"line\">258</span><br><span class=\"line\">259</span><br><span class=\"line\">260</span><br><span class=\"line\">261</span><br><span class=\"line\">262</span><br><span class=\"line\">263</span><br><span class=\"line\">264</span><br><span class=\"line\">265</span><br><span class=\"line\">266</span><br><span class=\"line\">267</span><br><span class=\"line\">268</span><br><span class=\"line\">269</span><br><span class=\"line\">270</span><br><span class=\"line\">271</span><br><span class=\"line\">272</span><br><span class=\"line\">273</span><br><span class=\"line\">274</span><br><span class=\"line\">275</span><br><span class=\"line\">276</span><br><span class=\"line\">277</span><br><span class=\"line\">278</span><br><span class=\"line\">279</span><br><span class=\"line\">280</span><br><span class=\"line\">281</span><br><span class=\"line\">282</span><br><span class=\"line\">283</span><br><span class=\"line\">284</span><br><span class=\"line\">285</span><br><span class=\"line\">286</span><br><span class=\"line\">287</span><br><span class=\"line\">288</span><br><span class=\"line\">289</span><br><span class=\"line\">290</span><br><span class=\"line\">291</span><br><span class=\"line\">292</span><br><span class=\"line\">293</span><br><span class=\"line\">294</span><br><span class=\"line\">295</span><br><span class=\"line\">296</span><br><span class=\"line\">297</span><br><span class=\"line\">298</span><br><span class=\"line\">299</span><br><span class=\"line\">300</span><br><span class=\"line\">301</span><br><span class=\"line\">302</span><br><span class=\"line\">303</span><br><span class=\"line\">304</span><br><span class=\"line\">305</span><br><span class=\"line\">306</span><br><span class=\"line\">307</span><br><span class=\"line\">308</span><br><span class=\"line\">309</span><br><span class=\"line\">310</span><br><span class=\"line\">311</span><br><span class=\"line\">312</span><br><span class=\"line\">313</span><br><span class=\"line\">314</span><br><span class=\"line\">315</span><br><span class=\"line\">316</span><br><span class=\"line\">317</span><br><span class=\"line\">318</span><br><span class=\"line\">319</span><br><span class=\"line\">320</span><br><span class=\"line\">321</span><br><span class=\"line\">322</span><br><span class=\"line\">323</span><br><span class=\"line\">324</span><br><span class=\"line\">325</span><br><span class=\"line\">326</span><br><span class=\"line\">327</span><br><span class=\"line\">328</span><br><span class=\"line\">329</span><br><span class=\"line\">330</span><br><span class=\"line\">331</span><br><span class=\"line\">332</span><br><span class=\"line\">333</span><br><span class=\"line\">334</span><br><span class=\"line\">335</span><br><span class=\"line\">336</span><br><span class=\"line\">337</span><br><span class=\"line\">338</span><br><span class=\"line\">339</span><br><span class=\"line\">340</span><br><span class=\"line\">341</span><br><span class=\"line\">342</span><br><span class=\"line\">343</span><br><span class=\"line\">344</span><br><span class=\"line\">345</span><br><span class=\"line\">346</span><br><span class=\"line\">347</span><br><span class=\"line\">348</span><br><span class=\"line\">349</span><br><span class=\"line\">350</span><br><span class=\"line\">351</span><br><span class=\"line\">352</span><br><span class=\"line\">353</span><br><span class=\"line\">354</span><br><span class=\"line\">355</span><br><span class=\"line\">356</span><br><span class=\"line\">357</span><br><span class=\"line\">358</span><br><span class=\"line\">359</span><br><span class=\"line\">360</span><br><span class=\"line\">361</span><br><span class=\"line\">362</span><br><span class=\"line\">363</span><br><span class=\"line\">364</span><br><span class=\"line\">365</span><br><span class=\"line\">366</span><br><span class=\"line\">367</span><br><span class=\"line\">368</span><br><span class=\"line\">369</span><br><span class=\"line\">370</span><br><span class=\"line\">371</span><br><span class=\"line\">372</span><br><span class=\"line\">373</span><br><span class=\"line\">374</span><br><span class=\"line\">375</span><br><span class=\"line\">376</span><br><span class=\"line\">377</span><br><span class=\"line\">378</span><br><span class=\"line\">379</span><br><span class=\"line\">380</span><br><span class=\"line\">381</span><br><span class=\"line\">382</span><br><span class=\"line\">383</span><br><span class=\"line\">384</span><br><span class=\"line\">385</span><br><span class=\"line\">386</span><br><span class=\"line\">387</span><br><span class=\"line\">388</span><br><span class=\"line\">389</span><br><span class=\"line\">390</span><br><span class=\"line\">391</span><br><span class=\"line\">392</span><br><span class=\"line\">393</span><br><span class=\"line\">394</span><br><span class=\"line\">395</span><br><span class=\"line\">396</span><br><span class=\"line\">397</span><br><span class=\"line\">398</span><br><span class=\"line\">399</span><br><span class=\"line\">400</span><br><span class=\"line\">401</span><br><span class=\"line\">402</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// CalculatorDlg.cpp: 实现文件</span></span><br><span class=\"line\"><span class=\"comment\">//</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">\"stdafx.h\"</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">\"Calculator.h\"</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">\"CalculatorDlg.h\"</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">\"afxdialogex.h\"</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">ifdef</span> _DEBUG</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> new DEBUG_NEW</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">endif</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 用于应用程序“关于”菜单项的 CAboutDlg 对话框</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CAboutDlg</span> :</span> <span class=\"keyword\">public</span> CDialogEx</span><br><span class=\"line\">&#123;</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">\tCAboutDlg();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 对话框数据</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">ifdef</span> AFX_DESIGN_TIME</span></span><br><span class=\"line\">\t<span class=\"keyword\">enum</span> &#123; IDD = IDD_ABOUTBOX &#125;;</span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">endif</span></span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">protected</span>:</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">virtual</span> <span class=\"keyword\">void</span> <span class=\"title\">DoDataExchange</span><span class=\"params\">(CDataExchange* pDX)</span></span>;    <span class=\"comment\">// DDX/DDV 支持</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 实现</span></span><br><span class=\"line\"><span class=\"keyword\">protected</span>:</span><br><span class=\"line\">\tDECLARE_MESSAGE_MAP()</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">CAboutDlg::CAboutDlg() : CDialogEx(IDD_ABOUTBOX)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">void</span> CAboutDlg::DoDataExchange(CDataExchange* pDX)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tCDialogEx::DoDataExchange(pDX);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">BEGIN_MESSAGE_MAP(CAboutDlg, CDialogEx)</span><br><span class=\"line\">END_MESSAGE_MAP()</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// CCalculatorDlg 对话框</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">CCalculatorDlg::CCalculatorDlg(CWnd* pParent <span class=\"comment\">/*=NULL*/</span>)</span><br><span class=\"line\">\t: CDialog(IDD_CALCULATOR_DIALOG, pParent)</span><br><span class=\"line\">\t, mStr(_T(<span class=\"string\">\"\"</span>))</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tm_hIcon = AfxGetApp()-&gt;LoadIcon(IDR_MAINFRAME);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">void</span> CCalculatorDlg::DoDataExchange(CDataExchange* pDX)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tCDialog::DoDataExchange(pDX);</span><br><span class=\"line\">\tDDX_Text(pDX, IDC_EDIT1, mStr);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">BEGIN_MESSAGE_MAP(CCalculatorDlg, CDialog)</span><br><span class=\"line\">\tON_WM_SYSCOMMAND()</span><br><span class=\"line\">\tON_WM_PAINT()</span><br><span class=\"line\">\tON_WM_QUERYDRAGICON()</span><br><span class=\"line\">\t</span><br><span class=\"line\">\tON_BN_CLICKED(IDC_BUTTON1, &amp;CCalculatorDlg::OnBnClickedButton1)</span><br><span class=\"line\">\tON_BN_CLICKED(IDC_BUTTON2, &amp;CCalculatorDlg::OnBnClickedButton2)</span><br><span class=\"line\">\tON_BN_CLICKED(IDC_BUTTON3, &amp;CCalculatorDlg::OnBnClickedButton3)</span><br><span class=\"line\">\tON_BN_CLICKED(IDC_BUTTON4, &amp;CCalculatorDlg::OnBnClickedButton4)</span><br><span class=\"line\">\tON_BN_CLICKED(IDC_BUTTON5, &amp;CCalculatorDlg::OnBnClickedButton5)</span><br><span class=\"line\">\tON_BN_CLICKED(IDC_BUTTON6, &amp;CCalculatorDlg::OnBnClickedButton6)</span><br><span class=\"line\">\tON_BN_CLICKED(IDC_BUTTON7, &amp;CCalculatorDlg::OnBnClickedButton7)</span><br><span class=\"line\">\tON_BN_CLICKED(IDC_BUTTON8, &amp;CCalculatorDlg::OnBnClickedButton8)</span><br><span class=\"line\">\tON_BN_CLICKED(IDC_BUTTON9, &amp;CCalculatorDlg::OnBnClickedButton9)</span><br><span class=\"line\">\tON_BN_CLICKED(IDC_BUTTON_DIAN, &amp;CCalculatorDlg::OnBnClickedButtonDian)</span><br><span class=\"line\">\tON_BN_CLICKED(IDC_BUTTON_JIA, &amp;CCalculatorDlg::OnBnClickedButtonJia)</span><br><span class=\"line\">\tON_BN_CLICKED(IDC_BUTTON_JIAN, &amp;CCalculatorDlg::OnBnClickedButtonJian)</span><br><span class=\"line\">\tON_BN_CLICKED(IDC_BUTTON_CHENG, &amp;CCalculatorDlg::OnBnClickedButtonCheng)</span><br><span class=\"line\">\tON_BN_CLICKED(IDC_BUTTON_CHU, &amp;CCalculatorDlg::OnBnClickedButtonChu)</span><br><span class=\"line\">\tON_BN_CLICKED(IDC_BUTTON_DENG, &amp;CCalculatorDlg::OnBnClickedButtonDeng)</span><br><span class=\"line\">\tON_BN_CLICKED(IDC_BUTTON_CLEAR, &amp;CCalculatorDlg::OnBnClickedButtonClear)</span><br><span class=\"line\">\tON_BN_CLICKED(IDC_BUTTON_BACK, &amp;CCalculatorDlg::OnBnClickedButtonBack)</span><br><span class=\"line\">\tON_BN_CLICKED(IDC_BUTTON0, &amp;CCalculatorDlg::OnBnClickedButton0)</span><br><span class=\"line\">\tON_EN_CHANGE(IDC_EDIT1, &amp;CCalculatorDlg::OnEnChangeEdit1)</span><br><span class=\"line\">END_MESSAGE_MAP()</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// CCalculatorDlg 消息处理程序</span></span><br><span class=\"line\"></span><br><span class=\"line\">BOOL CCalculatorDlg::OnInitDialog()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//CDialog::OnInitDialog();</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t</span><br><span class=\"line\">\t</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// 将“关于...”菜单项添加到系统菜单中。</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// IDM_ABOUTBOX 必须在系统命令范围内。</span></span><br><span class=\"line\">\tASSERT((IDM_ABOUTBOX &amp; <span class=\"number\">0xFFF0</span>) == IDM_ABOUTBOX);</span><br><span class=\"line\">\tASSERT(IDM_ABOUTBOX &lt; <span class=\"number\">0xF000</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">\tCMenu* pSysMenu = GetSystemMenu(FALSE);</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (pSysMenu != <span class=\"literal\">NULL</span>)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tBOOL bNameValid;</span><br><span class=\"line\">\t\tCString strAboutMenu;</span><br><span class=\"line\">\t\tbNameValid = strAboutMenu.LoadString(IDS_ABOUTBOX);</span><br><span class=\"line\">\t\tASSERT(bNameValid);</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (!strAboutMenu.IsEmpty())</span><br><span class=\"line\">\t\t&#123;</span><br><span class=\"line\">\t\t\tpSysMenu-&gt;AppendMenu(MF_SEPARATOR);</span><br><span class=\"line\">\t\t\tpSysMenu-&gt;AppendMenu(MF_STRING, IDM_ABOUTBOX, strAboutMenu);</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// 设置此对话框的图标。  当应用程序主窗口不是对话框时，框架将自动</span></span><br><span class=\"line\">\t<span class=\"comment\">//  执行此操作</span></span><br><span class=\"line\">\tSetIcon(m_hIcon, TRUE);\t\t\t<span class=\"comment\">// 设置大图标</span></span><br><span class=\"line\">\tSetIcon(m_hIcon, FALSE);\t\t<span class=\"comment\">// 设置小图标</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// <span class=\"doctag\">TODO:</span> 在此添加额外的初始化代码</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">return</span> TRUE;  <span class=\"comment\">// 除非将焦点设置到控件，否则返回 TRUE</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">void</span> CCalculatorDlg::OnSysCommand(UINT nID, LPARAM lParam)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> ((nID &amp; <span class=\"number\">0xFFF0</span>) == IDM_ABOUTBOX)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tCAboutDlg dlgAbout;</span><br><span class=\"line\">\t\tdlgAbout.DoModal();</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">else</span></span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tCDialog::OnSysCommand(nID, lParam);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 如果向对话框添加最小化按钮，则需要下面的代码</span></span><br><span class=\"line\"><span class=\"comment\">//  来绘制该图标。  对于使用文档/视图模型的 MFC 应用程序，</span></span><br><span class=\"line\"><span class=\"comment\">//  这将由框架自动完成。</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">void</span> CCalculatorDlg::OnPaint()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (IsIconic())</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"function\">CPaintDC <span class=\"title\">dc</span><span class=\"params\">(<span class=\"keyword\">this</span>)</span></span>; <span class=\"comment\">// 用于绘制的设备上下文</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t\tSendMessage(WM_ICONERASEBKGND, <span class=\"keyword\">reinterpret_cast</span>&lt;WPARAM&gt;(dc.GetSafeHdc()), <span class=\"number\">0</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"comment\">// 使图标在工作区矩形中居中</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">int</span> cxIcon = GetSystemMetrics(SM_CXICON);</span><br><span class=\"line\">\t\t<span class=\"keyword\">int</span> cyIcon = GetSystemMetrics(SM_CYICON);</span><br><span class=\"line\">\t\tCRect rect;</span><br><span class=\"line\">\t\tGetClientRect(&amp;rect);</span><br><span class=\"line\">\t\t<span class=\"keyword\">int</span> x = (rect.Width() - cxIcon + <span class=\"number\">1</span>) / <span class=\"number\">2</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">int</span> y = (rect.Height() - cyIcon + <span class=\"number\">1</span>) / <span class=\"number\">2</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"comment\">// 绘制图标</span></span><br><span class=\"line\">\t\tdc.DrawIcon(x, y, m_hIcon);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">else</span></span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tCDialog::OnPaint();</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//当用户拖动最小化窗口时系统调用此函数取得光标</span></span><br><span class=\"line\"><span class=\"comment\">//显示。</span></span><br><span class=\"line\">HCURSOR CCalculatorDlg::OnQueryDragIcon()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"keyword\">static_cast</span>&lt;HCURSOR&gt;(m_hIcon);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">void</span> CCalculatorDlg::OnBnClickedButton1()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tUpdateData(TRUE);</span><br><span class=\"line\">\tmStr += <span class=\"string\">L\"1\"</span>;</span><br><span class=\"line\">\tUpdateData(FALSE);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">void</span> CCalculatorDlg::OnBnClickedButton2()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tUpdateData(TRUE);</span><br><span class=\"line\">\tmStr += <span class=\"string\">L\"2\"</span>;</span><br><span class=\"line\">\tUpdateData(FALSE);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">void</span> CCalculatorDlg::OnBnClickedButton3()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tUpdateData(TRUE);</span><br><span class=\"line\">\tmStr += <span class=\"string\">L\"3\"</span>;</span><br><span class=\"line\">\tUpdateData(FALSE);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">void</span> CCalculatorDlg::OnBnClickedButton4()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tUpdateData(TRUE);</span><br><span class=\"line\">\tmStr += <span class=\"string\">L\"4\"</span>;</span><br><span class=\"line\">\tUpdateData(FALSE);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">void</span> CCalculatorDlg::OnBnClickedButton5()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tUpdateData(TRUE);</span><br><span class=\"line\">\tmStr += <span class=\"string\">L\"5\"</span>;</span><br><span class=\"line\">\tUpdateData(FALSE);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">void</span> CCalculatorDlg::OnBnClickedButton6()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tUpdateData(TRUE);</span><br><span class=\"line\">\tmStr += <span class=\"string\">L\"6\"</span>;</span><br><span class=\"line\">\tUpdateData(FALSE);</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">void</span> CCalculatorDlg::OnBnClickedButton7()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tUpdateData(TRUE);</span><br><span class=\"line\">\tmStr += <span class=\"string\">L\"7\"</span>;</span><br><span class=\"line\">\tUpdateData(FALSE);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">void</span> CCalculatorDlg::OnBnClickedButton8()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tUpdateData(TRUE);</span><br><span class=\"line\">\tmStr += <span class=\"string\">L\"8\"</span>;</span><br><span class=\"line\">\tUpdateData(FALSE);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">void</span> CCalculatorDlg::OnBnClickedButton9()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tUpdateData(TRUE);</span><br><span class=\"line\">\tmStr += <span class=\"string\">L\"9\"</span>;</span><br><span class=\"line\">\tUpdateData(FALSE);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">void</span> CCalculatorDlg::OnBnClickedButton0()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tUpdateData(TRUE);</span><br><span class=\"line\">\tmStr += <span class=\"string\">L\"0\"</span>;</span><br><span class=\"line\">\tUpdateData(FALSE);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">void</span> CCalculatorDlg::OnBnClickedButtonDian()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tUpdateData(TRUE);</span><br><span class=\"line\">\t<span class=\"comment\">//如果没有小数点，则加上一个小数点，如果已有小数点就忽略此次的小数点，保证最多只有1个    </span></span><br><span class=\"line\">\tif (-1 == mStr.Find(L'.'))</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tmStr += <span class=\"string\">L\".\"</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tUpdateData(FALSE);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">void</span> CCalculatorDlg::OnBnClickedButtonJia()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tSaveFirstValue();</span><br><span class=\"line\">\tmFlag = FLAG_JIA;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">void</span> CCalculatorDlg::OnBnClickedButtonJian()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tSaveFirstValue();</span><br><span class=\"line\">\tmFlag = FLAG_JIAN;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">void</span> CCalculatorDlg::OnBnClickedButtonCheng()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tSaveFirstValue();</span><br><span class=\"line\">\tmFlag = FLAG_CHENG;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">void</span> CCalculatorDlg::OnBnClickedButtonChu()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tSaveFirstValue();</span><br><span class=\"line\">\tmFlag = FLAG_CHU;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">void</span> CCalculatorDlg::OnBnClickedButtonDeng()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tCalculator();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">void</span> CCalculatorDlg::OnBnClickedButtonClear()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tUpdateData(TRUE);</span><br><span class=\"line\">\tmStr = <span class=\"string\">L\"\"</span>;</span><br><span class=\"line\">\tmNum1 = <span class=\"number\">0.0f</span>;</span><br><span class=\"line\">\tmNum2 = <span class=\"number\">0.0f</span>;</span><br><span class=\"line\">\tmFlag = FLAG_JIA;</span><br><span class=\"line\">\tUpdateData(FALSE);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">void</span> CCalculatorDlg::OnBnClickedButtonBack()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tUpdateData(TRUE);</span><br><span class=\"line\">\t<span class=\"comment\">//移除最右边一个字符    </span></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (!mStr.IsEmpty())</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tmStr = mStr.Left(mStr.GetLength() - <span class=\"number\">1</span>);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tUpdateData(FALSE);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//计算结果  </span></span><br><span class=\"line\"><span class=\"keyword\">void</span> CCalculatorDlg::Calculator()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tUpdateData(TRUE);</span><br><span class=\"line\">\tmNum2 = _wtof(mStr);</span><br><span class=\"line\">\t<span class=\"keyword\">double</span> result = <span class=\"number\">0.0f</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">switch</span> (mFlag)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">case</span> FLAG_JIA:                      <span class=\"comment\">//加    </span></span><br><span class=\"line\">\t\tresult = mNum1 + mNum2;</span><br><span class=\"line\">\t\t<span class=\"keyword\">break</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">case</span> FLAG_JIAN:                     <span class=\"comment\">//减   </span></span><br><span class=\"line\">\t\tresult = mNum1 - mNum2;</span><br><span class=\"line\">\t\t<span class=\"keyword\">break</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">case</span> FLAG_CHENG:                    <span class=\"comment\">//乘    </span></span><br><span class=\"line\">\t\tresult = mNum1 * mNum2;</span><br><span class=\"line\">\t\t<span class=\"keyword\">break</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">case</span> FLAG_CHU:                      <span class=\"comment\">//除    </span></span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (mNum2 == <span class=\"number\">0.0f</span>)</span><br><span class=\"line\">\t\t&#123;</span><br><span class=\"line\">\t\t\tresult = mNum1;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"keyword\">else</span></span><br><span class=\"line\">\t\t&#123;</span><br><span class=\"line\">\t\t\tresult = mNum1 / mNum2;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"keyword\">break</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">case</span> FLAG_PINGFANG:                 <span class=\"comment\">//平方   </span></span><br><span class=\"line\">\t\tresult = mNum2 * mNum2;</span><br><span class=\"line\">\t\t<span class=\"keyword\">break</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">case</span> FLAG_KAIFANG:                  <span class=\"comment\">//开方    </span></span><br><span class=\"line\">\t\tresult = <span class=\"built_in\">sqrt</span>(mNum2);</span><br><span class=\"line\">\t\t<span class=\"keyword\">break</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">default</span>:</span><br><span class=\"line\">\t\t<span class=\"keyword\">break</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"comment\">//如果浮点数其实是个整数,就显示为整数  </span></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (result - <span class=\"keyword\">int</span>(result) &lt;= <span class=\"number\">1e-5</span>)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tmStr.Format(<span class=\"string\">L\"%d\"</span>, (<span class=\"keyword\">int</span>)result);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">else</span></span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tmStr.Format(<span class=\"string\">L\"%f\"</span>, result);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tUpdateData(FALSE);</span><br><span class=\"line\"></span><br><span class=\"line\">\tmNum1 = result;</span><br><span class=\"line\">\tmNum2 = <span class=\"number\">0.0f</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">void</span> CCalculatorDlg::SaveFirstValue()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tUpdateData(TRUE);</span><br><span class=\"line\">\tmNum1 = _wtof(mStr);</span><br><span class=\"line\">\tmStr = <span class=\"string\">L\"\"</span>;</span><br><span class=\"line\">\tUpdateData(FALSE);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">void</span> CCalculatorDlg::OnEnChangeEdit1()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>","more":"<h2 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h2><p>最近开始学习MFC，第一个项目就是计算器。</p>\n<h2 id=\"效果\"><a href=\"#效果\" class=\"headerlink\" title=\"效果\"></a>效果</h2><p><img src=\"http://tysb7.cn/wp-content/uploads/2017/10/QQ截图20171030204944.png\" alt=\"Markdown\"></p>\n<h2 id=\"CalculatorDlg-h\"><a href=\"#CalculatorDlg-h\" class=\"headerlink\" title=\"CalculatorDlg.h\"></a>CalculatorDlg.h</h2><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// CalculatorDlg.h: 头文件</span></span><br><span class=\"line\"><span class=\"comment\">//</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">pragma</span> once</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">enum</span> CALCULATOR_FLAG &#123;</span><br><span class=\"line\">\tFLAG_JIA = <span class=\"number\">0</span>,</span><br><span class=\"line\">\tFLAG_JIAN,</span><br><span class=\"line\">\tFLAG_CHENG,</span><br><span class=\"line\">\tFLAG_CHU,</span><br><span class=\"line\">\tFLAG_PINGFANG,</span><br><span class=\"line\">\tFLAG_KAIFANG,</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// CCalculatorDlg 对话框</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CCalculatorDlg</span> :</span> <span class=\"keyword\">public</span> CDialog</span><br><span class=\"line\">&#123;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//class CCalculatorDlg : public CDialogEx</span></span><br><span class=\"line\"><span class=\"comment\">//&#123;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 构造</span></span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">\tCCalculatorDlg(CWnd* pParent = <span class=\"literal\">NULL</span>);\t<span class=\"comment\">// 标准构造函数</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 对话框数据</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">ifdef</span> AFX_DESIGN_TIME</span></span><br><span class=\"line\">\t<span class=\"keyword\">enum</span> &#123; IDD = IDD_CALCULATOR_DIALOG &#125;;</span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">endif</span></span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">SaveFirstValue</span><span class=\"params\">()</span></span>;      <span class=\"comment\">//保存第一个输入值  </span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">Calculator</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">\t<span class=\"keyword\">protected</span>:</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">virtual</span> <span class=\"keyword\">void</span> <span class=\"title\">DoDataExchange</span><span class=\"params\">(CDataExchange* pDX)</span></span>;\t<span class=\"comment\">// DDX/DDV 支持</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 实现</span></span><br><span class=\"line\"><span class=\"keyword\">protected</span>:</span><br><span class=\"line\">\tHICON m_hIcon;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// 生成的消息映射函数</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">virtual</span> BOOL <span class=\"title\">OnInitDialog</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">\t<span class=\"function\">afx_msg <span class=\"keyword\">void</span> <span class=\"title\">OnSysCommand</span><span class=\"params\">(UINT nID, LPARAM lParam)</span></span>;</span><br><span class=\"line\">\t<span class=\"function\">afx_msg <span class=\"keyword\">void</span> <span class=\"title\">OnPaint</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">\t<span class=\"function\">afx_msg HCURSOR <span class=\"title\">OnQueryDragIcon</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">\tDECLARE_MESSAGE_MAP()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">\t</span><br><span class=\"line\">\tCString mStr;</span><br><span class=\"line\">\t<span class=\"function\">afx_msg <span class=\"keyword\">void</span> <span class=\"title\">OnBnClickedButton1</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">\t<span class=\"function\">afx_msg <span class=\"keyword\">void</span> <span class=\"title\">OnBnClickedButton2</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">\t<span class=\"function\">afx_msg <span class=\"keyword\">void</span> <span class=\"title\">OnBnClickedButton3</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">\t<span class=\"function\">afx_msg <span class=\"keyword\">void</span> <span class=\"title\">OnBnClickedButton4</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">\t<span class=\"function\">afx_msg <span class=\"keyword\">void</span> <span class=\"title\">OnBnClickedButton5</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">\t<span class=\"function\">afx_msg <span class=\"keyword\">void</span> <span class=\"title\">OnBnClickedButton6</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">\t<span class=\"function\">afx_msg <span class=\"keyword\">void</span> <span class=\"title\">OnBnClickedButton7</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">\t<span class=\"function\">afx_msg <span class=\"keyword\">void</span> <span class=\"title\">OnBnClickedButton8</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">\t<span class=\"function\">afx_msg <span class=\"keyword\">void</span> <span class=\"title\">OnBnClickedButton9</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">\t<span class=\"function\">afx_msg <span class=\"keyword\">void</span> <span class=\"title\">OnBnClickedButton0</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">\t<span class=\"function\">afx_msg <span class=\"keyword\">void</span> <span class=\"title\">OnBnClickedButtonDian</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">\t<span class=\"function\">afx_msg <span class=\"keyword\">void</span> <span class=\"title\">OnBnClickedButtonJia</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">\t<span class=\"function\">afx_msg <span class=\"keyword\">void</span> <span class=\"title\">OnBnClickedButtonJian</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">\t<span class=\"function\">afx_msg <span class=\"keyword\">void</span> <span class=\"title\">OnBnClickedButtonCheng</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">\t<span class=\"function\">afx_msg <span class=\"keyword\">void</span> <span class=\"title\">OnBnClickedButtonChu</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">\t<span class=\"function\">afx_msg <span class=\"keyword\">void</span> <span class=\"title\">OnBnClickedButtonDeng</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">\t<span class=\"function\">afx_msg <span class=\"keyword\">void</span> <span class=\"title\">OnBnClickedButtonClear</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">\t<span class=\"function\">afx_msg <span class=\"keyword\">void</span> <span class=\"title\">OnBnClickedButtonBack</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">\t</span><br><span class=\"line\"><span class=\"keyword\">private</span>:</span><br><span class=\"line\">\t<span class=\"comment\">//编辑框内的字符串  </span></span><br><span class=\"line\">\t<span class=\"comment\">//输入的2个值    </span></span><br><span class=\"line\">\t<span class=\"keyword\">double</span> mNum1;</span><br><span class=\"line\">\t<span class=\"keyword\">double</span> mNum2;</span><br><span class=\"line\">\t<span class=\"comment\">//运算符号  </span></span><br><span class=\"line\">\tCALCULATOR_FLAG mFlag;</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">\t<span class=\"function\">afx_msg <span class=\"keyword\">void</span> <span class=\"title\">OnEnChangeEdit1</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<h2 id=\"CalculatorDlg-cpp\"><a href=\"#CalculatorDlg-cpp\" class=\"headerlink\" title=\"CalculatorDlg.cpp\"></a>CalculatorDlg.cpp</h2><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br><span class=\"line\">245</span><br><span class=\"line\">246</span><br><span class=\"line\">247</span><br><span class=\"line\">248</span><br><span class=\"line\">249</span><br><span class=\"line\">250</span><br><span class=\"line\">251</span><br><span class=\"line\">252</span><br><span class=\"line\">253</span><br><span class=\"line\">254</span><br><span class=\"line\">255</span><br><span class=\"line\">256</span><br><span class=\"line\">257</span><br><span class=\"line\">258</span><br><span class=\"line\">259</span><br><span class=\"line\">260</span><br><span class=\"line\">261</span><br><span class=\"line\">262</span><br><span class=\"line\">263</span><br><span class=\"line\">264</span><br><span class=\"line\">265</span><br><span class=\"line\">266</span><br><span class=\"line\">267</span><br><span class=\"line\">268</span><br><span class=\"line\">269</span><br><span class=\"line\">270</span><br><span class=\"line\">271</span><br><span class=\"line\">272</span><br><span class=\"line\">273</span><br><span class=\"line\">274</span><br><span class=\"line\">275</span><br><span class=\"line\">276</span><br><span class=\"line\">277</span><br><span class=\"line\">278</span><br><span class=\"line\">279</span><br><span class=\"line\">280</span><br><span class=\"line\">281</span><br><span class=\"line\">282</span><br><span class=\"line\">283</span><br><span class=\"line\">284</span><br><span class=\"line\">285</span><br><span class=\"line\">286</span><br><span class=\"line\">287</span><br><span class=\"line\">288</span><br><span class=\"line\">289</span><br><span class=\"line\">290</span><br><span class=\"line\">291</span><br><span class=\"line\">292</span><br><span class=\"line\">293</span><br><span class=\"line\">294</span><br><span class=\"line\">295</span><br><span class=\"line\">296</span><br><span class=\"line\">297</span><br><span class=\"line\">298</span><br><span class=\"line\">299</span><br><span class=\"line\">300</span><br><span class=\"line\">301</span><br><span class=\"line\">302</span><br><span class=\"line\">303</span><br><span class=\"line\">304</span><br><span class=\"line\">305</span><br><span class=\"line\">306</span><br><span class=\"line\">307</span><br><span class=\"line\">308</span><br><span class=\"line\">309</span><br><span class=\"line\">310</span><br><span class=\"line\">311</span><br><span class=\"line\">312</span><br><span class=\"line\">313</span><br><span class=\"line\">314</span><br><span class=\"line\">315</span><br><span class=\"line\">316</span><br><span class=\"line\">317</span><br><span class=\"line\">318</span><br><span class=\"line\">319</span><br><span class=\"line\">320</span><br><span class=\"line\">321</span><br><span class=\"line\">322</span><br><span class=\"line\">323</span><br><span class=\"line\">324</span><br><span class=\"line\">325</span><br><span class=\"line\">326</span><br><span class=\"line\">327</span><br><span class=\"line\">328</span><br><span class=\"line\">329</span><br><span class=\"line\">330</span><br><span class=\"line\">331</span><br><span class=\"line\">332</span><br><span class=\"line\">333</span><br><span class=\"line\">334</span><br><span class=\"line\">335</span><br><span class=\"line\">336</span><br><span class=\"line\">337</span><br><span class=\"line\">338</span><br><span class=\"line\">339</span><br><span class=\"line\">340</span><br><span class=\"line\">341</span><br><span class=\"line\">342</span><br><span class=\"line\">343</span><br><span class=\"line\">344</span><br><span class=\"line\">345</span><br><span class=\"line\">346</span><br><span class=\"line\">347</span><br><span class=\"line\">348</span><br><span class=\"line\">349</span><br><span class=\"line\">350</span><br><span class=\"line\">351</span><br><span class=\"line\">352</span><br><span class=\"line\">353</span><br><span class=\"line\">354</span><br><span class=\"line\">355</span><br><span class=\"line\">356</span><br><span class=\"line\">357</span><br><span class=\"line\">358</span><br><span class=\"line\">359</span><br><span class=\"line\">360</span><br><span class=\"line\">361</span><br><span class=\"line\">362</span><br><span class=\"line\">363</span><br><span class=\"line\">364</span><br><span class=\"line\">365</span><br><span class=\"line\">366</span><br><span class=\"line\">367</span><br><span class=\"line\">368</span><br><span class=\"line\">369</span><br><span class=\"line\">370</span><br><span class=\"line\">371</span><br><span class=\"line\">372</span><br><span class=\"line\">373</span><br><span class=\"line\">374</span><br><span class=\"line\">375</span><br><span class=\"line\">376</span><br><span class=\"line\">377</span><br><span class=\"line\">378</span><br><span class=\"line\">379</span><br><span class=\"line\">380</span><br><span class=\"line\">381</span><br><span class=\"line\">382</span><br><span class=\"line\">383</span><br><span class=\"line\">384</span><br><span class=\"line\">385</span><br><span class=\"line\">386</span><br><span class=\"line\">387</span><br><span class=\"line\">388</span><br><span class=\"line\">389</span><br><span class=\"line\">390</span><br><span class=\"line\">391</span><br><span class=\"line\">392</span><br><span class=\"line\">393</span><br><span class=\"line\">394</span><br><span class=\"line\">395</span><br><span class=\"line\">396</span><br><span class=\"line\">397</span><br><span class=\"line\">398</span><br><span class=\"line\">399</span><br><span class=\"line\">400</span><br><span class=\"line\">401</span><br><span class=\"line\">402</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// CalculatorDlg.cpp: 实现文件</span></span><br><span class=\"line\"><span class=\"comment\">//</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">\"stdafx.h\"</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">\"Calculator.h\"</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">\"CalculatorDlg.h\"</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">\"afxdialogex.h\"</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">ifdef</span> _DEBUG</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> new DEBUG_NEW</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">endif</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 用于应用程序“关于”菜单项的 CAboutDlg 对话框</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CAboutDlg</span> :</span> <span class=\"keyword\">public</span> CDialogEx</span><br><span class=\"line\">&#123;</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">\tCAboutDlg();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 对话框数据</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">ifdef</span> AFX_DESIGN_TIME</span></span><br><span class=\"line\">\t<span class=\"keyword\">enum</span> &#123; IDD = IDD_ABOUTBOX &#125;;</span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">endif</span></span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">protected</span>:</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">virtual</span> <span class=\"keyword\">void</span> <span class=\"title\">DoDataExchange</span><span class=\"params\">(CDataExchange* pDX)</span></span>;    <span class=\"comment\">// DDX/DDV 支持</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 实现</span></span><br><span class=\"line\"><span class=\"keyword\">protected</span>:</span><br><span class=\"line\">\tDECLARE_MESSAGE_MAP()</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">CAboutDlg::CAboutDlg() : CDialogEx(IDD_ABOUTBOX)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">void</span> CAboutDlg::DoDataExchange(CDataExchange* pDX)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tCDialogEx::DoDataExchange(pDX);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">BEGIN_MESSAGE_MAP(CAboutDlg, CDialogEx)</span><br><span class=\"line\">END_MESSAGE_MAP()</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// CCalculatorDlg 对话框</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">CCalculatorDlg::CCalculatorDlg(CWnd* pParent <span class=\"comment\">/*=NULL*/</span>)</span><br><span class=\"line\">\t: CDialog(IDD_CALCULATOR_DIALOG, pParent)</span><br><span class=\"line\">\t, mStr(_T(<span class=\"string\">\"\"</span>))</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tm_hIcon = AfxGetApp()-&gt;LoadIcon(IDR_MAINFRAME);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">void</span> CCalculatorDlg::DoDataExchange(CDataExchange* pDX)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tCDialog::DoDataExchange(pDX);</span><br><span class=\"line\">\tDDX_Text(pDX, IDC_EDIT1, mStr);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">BEGIN_MESSAGE_MAP(CCalculatorDlg, CDialog)</span><br><span class=\"line\">\tON_WM_SYSCOMMAND()</span><br><span class=\"line\">\tON_WM_PAINT()</span><br><span class=\"line\">\tON_WM_QUERYDRAGICON()</span><br><span class=\"line\">\t</span><br><span class=\"line\">\tON_BN_CLICKED(IDC_BUTTON1, &amp;CCalculatorDlg::OnBnClickedButton1)</span><br><span class=\"line\">\tON_BN_CLICKED(IDC_BUTTON2, &amp;CCalculatorDlg::OnBnClickedButton2)</span><br><span class=\"line\">\tON_BN_CLICKED(IDC_BUTTON3, &amp;CCalculatorDlg::OnBnClickedButton3)</span><br><span class=\"line\">\tON_BN_CLICKED(IDC_BUTTON4, &amp;CCalculatorDlg::OnBnClickedButton4)</span><br><span class=\"line\">\tON_BN_CLICKED(IDC_BUTTON5, &amp;CCalculatorDlg::OnBnClickedButton5)</span><br><span class=\"line\">\tON_BN_CLICKED(IDC_BUTTON6, &amp;CCalculatorDlg::OnBnClickedButton6)</span><br><span class=\"line\">\tON_BN_CLICKED(IDC_BUTTON7, &amp;CCalculatorDlg::OnBnClickedButton7)</span><br><span class=\"line\">\tON_BN_CLICKED(IDC_BUTTON8, &amp;CCalculatorDlg::OnBnClickedButton8)</span><br><span class=\"line\">\tON_BN_CLICKED(IDC_BUTTON9, &amp;CCalculatorDlg::OnBnClickedButton9)</span><br><span class=\"line\">\tON_BN_CLICKED(IDC_BUTTON_DIAN, &amp;CCalculatorDlg::OnBnClickedButtonDian)</span><br><span class=\"line\">\tON_BN_CLICKED(IDC_BUTTON_JIA, &amp;CCalculatorDlg::OnBnClickedButtonJia)</span><br><span class=\"line\">\tON_BN_CLICKED(IDC_BUTTON_JIAN, &amp;CCalculatorDlg::OnBnClickedButtonJian)</span><br><span class=\"line\">\tON_BN_CLICKED(IDC_BUTTON_CHENG, &amp;CCalculatorDlg::OnBnClickedButtonCheng)</span><br><span class=\"line\">\tON_BN_CLICKED(IDC_BUTTON_CHU, &amp;CCalculatorDlg::OnBnClickedButtonChu)</span><br><span class=\"line\">\tON_BN_CLICKED(IDC_BUTTON_DENG, &amp;CCalculatorDlg::OnBnClickedButtonDeng)</span><br><span class=\"line\">\tON_BN_CLICKED(IDC_BUTTON_CLEAR, &amp;CCalculatorDlg::OnBnClickedButtonClear)</span><br><span class=\"line\">\tON_BN_CLICKED(IDC_BUTTON_BACK, &amp;CCalculatorDlg::OnBnClickedButtonBack)</span><br><span class=\"line\">\tON_BN_CLICKED(IDC_BUTTON0, &amp;CCalculatorDlg::OnBnClickedButton0)</span><br><span class=\"line\">\tON_EN_CHANGE(IDC_EDIT1, &amp;CCalculatorDlg::OnEnChangeEdit1)</span><br><span class=\"line\">END_MESSAGE_MAP()</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// CCalculatorDlg 消息处理程序</span></span><br><span class=\"line\"></span><br><span class=\"line\">BOOL CCalculatorDlg::OnInitDialog()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//CDialog::OnInitDialog();</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t</span><br><span class=\"line\">\t</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// 将“关于...”菜单项添加到系统菜单中。</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// IDM_ABOUTBOX 必须在系统命令范围内。</span></span><br><span class=\"line\">\tASSERT((IDM_ABOUTBOX &amp; <span class=\"number\">0xFFF0</span>) == IDM_ABOUTBOX);</span><br><span class=\"line\">\tASSERT(IDM_ABOUTBOX &lt; <span class=\"number\">0xF000</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">\tCMenu* pSysMenu = GetSystemMenu(FALSE);</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (pSysMenu != <span class=\"literal\">NULL</span>)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tBOOL bNameValid;</span><br><span class=\"line\">\t\tCString strAboutMenu;</span><br><span class=\"line\">\t\tbNameValid = strAboutMenu.LoadString(IDS_ABOUTBOX);</span><br><span class=\"line\">\t\tASSERT(bNameValid);</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (!strAboutMenu.IsEmpty())</span><br><span class=\"line\">\t\t&#123;</span><br><span class=\"line\">\t\t\tpSysMenu-&gt;AppendMenu(MF_SEPARATOR);</span><br><span class=\"line\">\t\t\tpSysMenu-&gt;AppendMenu(MF_STRING, IDM_ABOUTBOX, strAboutMenu);</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// 设置此对话框的图标。  当应用程序主窗口不是对话框时，框架将自动</span></span><br><span class=\"line\">\t<span class=\"comment\">//  执行此操作</span></span><br><span class=\"line\">\tSetIcon(m_hIcon, TRUE);\t\t\t<span class=\"comment\">// 设置大图标</span></span><br><span class=\"line\">\tSetIcon(m_hIcon, FALSE);\t\t<span class=\"comment\">// 设置小图标</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// <span class=\"doctag\">TODO:</span> 在此添加额外的初始化代码</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">return</span> TRUE;  <span class=\"comment\">// 除非将焦点设置到控件，否则返回 TRUE</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">void</span> CCalculatorDlg::OnSysCommand(UINT nID, LPARAM lParam)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> ((nID &amp; <span class=\"number\">0xFFF0</span>) == IDM_ABOUTBOX)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tCAboutDlg dlgAbout;</span><br><span class=\"line\">\t\tdlgAbout.DoModal();</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">else</span></span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tCDialog::OnSysCommand(nID, lParam);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 如果向对话框添加最小化按钮，则需要下面的代码</span></span><br><span class=\"line\"><span class=\"comment\">//  来绘制该图标。  对于使用文档/视图模型的 MFC 应用程序，</span></span><br><span class=\"line\"><span class=\"comment\">//  这将由框架自动完成。</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">void</span> CCalculatorDlg::OnPaint()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (IsIconic())</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"function\">CPaintDC <span class=\"title\">dc</span><span class=\"params\">(<span class=\"keyword\">this</span>)</span></span>; <span class=\"comment\">// 用于绘制的设备上下文</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t\tSendMessage(WM_ICONERASEBKGND, <span class=\"keyword\">reinterpret_cast</span>&lt;WPARAM&gt;(dc.GetSafeHdc()), <span class=\"number\">0</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"comment\">// 使图标在工作区矩形中居中</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">int</span> cxIcon = GetSystemMetrics(SM_CXICON);</span><br><span class=\"line\">\t\t<span class=\"keyword\">int</span> cyIcon = GetSystemMetrics(SM_CYICON);</span><br><span class=\"line\">\t\tCRect rect;</span><br><span class=\"line\">\t\tGetClientRect(&amp;rect);</span><br><span class=\"line\">\t\t<span class=\"keyword\">int</span> x = (rect.Width() - cxIcon + <span class=\"number\">1</span>) / <span class=\"number\">2</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">int</span> y = (rect.Height() - cyIcon + <span class=\"number\">1</span>) / <span class=\"number\">2</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"comment\">// 绘制图标</span></span><br><span class=\"line\">\t\tdc.DrawIcon(x, y, m_hIcon);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">else</span></span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tCDialog::OnPaint();</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//当用户拖动最小化窗口时系统调用此函数取得光标</span></span><br><span class=\"line\"><span class=\"comment\">//显示。</span></span><br><span class=\"line\">HCURSOR CCalculatorDlg::OnQueryDragIcon()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"keyword\">static_cast</span>&lt;HCURSOR&gt;(m_hIcon);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">void</span> CCalculatorDlg::OnBnClickedButton1()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tUpdateData(TRUE);</span><br><span class=\"line\">\tmStr += <span class=\"string\">L\"1\"</span>;</span><br><span class=\"line\">\tUpdateData(FALSE);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">void</span> CCalculatorDlg::OnBnClickedButton2()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tUpdateData(TRUE);</span><br><span class=\"line\">\tmStr += <span class=\"string\">L\"2\"</span>;</span><br><span class=\"line\">\tUpdateData(FALSE);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">void</span> CCalculatorDlg::OnBnClickedButton3()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tUpdateData(TRUE);</span><br><span class=\"line\">\tmStr += <span class=\"string\">L\"3\"</span>;</span><br><span class=\"line\">\tUpdateData(FALSE);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">void</span> CCalculatorDlg::OnBnClickedButton4()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tUpdateData(TRUE);</span><br><span class=\"line\">\tmStr += <span class=\"string\">L\"4\"</span>;</span><br><span class=\"line\">\tUpdateData(FALSE);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">void</span> CCalculatorDlg::OnBnClickedButton5()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tUpdateData(TRUE);</span><br><span class=\"line\">\tmStr += <span class=\"string\">L\"5\"</span>;</span><br><span class=\"line\">\tUpdateData(FALSE);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">void</span> CCalculatorDlg::OnBnClickedButton6()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tUpdateData(TRUE);</span><br><span class=\"line\">\tmStr += <span class=\"string\">L\"6\"</span>;</span><br><span class=\"line\">\tUpdateData(FALSE);</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">void</span> CCalculatorDlg::OnBnClickedButton7()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tUpdateData(TRUE);</span><br><span class=\"line\">\tmStr += <span class=\"string\">L\"7\"</span>;</span><br><span class=\"line\">\tUpdateData(FALSE);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">void</span> CCalculatorDlg::OnBnClickedButton8()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tUpdateData(TRUE);</span><br><span class=\"line\">\tmStr += <span class=\"string\">L\"8\"</span>;</span><br><span class=\"line\">\tUpdateData(FALSE);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">void</span> CCalculatorDlg::OnBnClickedButton9()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tUpdateData(TRUE);</span><br><span class=\"line\">\tmStr += <span class=\"string\">L\"9\"</span>;</span><br><span class=\"line\">\tUpdateData(FALSE);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">void</span> CCalculatorDlg::OnBnClickedButton0()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tUpdateData(TRUE);</span><br><span class=\"line\">\tmStr += <span class=\"string\">L\"0\"</span>;</span><br><span class=\"line\">\tUpdateData(FALSE);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">void</span> CCalculatorDlg::OnBnClickedButtonDian()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tUpdateData(TRUE);</span><br><span class=\"line\">\t<span class=\"comment\">//如果没有小数点，则加上一个小数点，如果已有小数点就忽略此次的小数点，保证最多只有1个    </span></span><br><span class=\"line\">\tif (-1 == mStr.Find(L'.'))</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tmStr += <span class=\"string\">L\".\"</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tUpdateData(FALSE);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">void</span> CCalculatorDlg::OnBnClickedButtonJia()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tSaveFirstValue();</span><br><span class=\"line\">\tmFlag = FLAG_JIA;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">void</span> CCalculatorDlg::OnBnClickedButtonJian()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tSaveFirstValue();</span><br><span class=\"line\">\tmFlag = FLAG_JIAN;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">void</span> CCalculatorDlg::OnBnClickedButtonCheng()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tSaveFirstValue();</span><br><span class=\"line\">\tmFlag = FLAG_CHENG;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">void</span> CCalculatorDlg::OnBnClickedButtonChu()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tSaveFirstValue();</span><br><span class=\"line\">\tmFlag = FLAG_CHU;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">void</span> CCalculatorDlg::OnBnClickedButtonDeng()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tCalculator();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">void</span> CCalculatorDlg::OnBnClickedButtonClear()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tUpdateData(TRUE);</span><br><span class=\"line\">\tmStr = <span class=\"string\">L\"\"</span>;</span><br><span class=\"line\">\tmNum1 = <span class=\"number\">0.0f</span>;</span><br><span class=\"line\">\tmNum2 = <span class=\"number\">0.0f</span>;</span><br><span class=\"line\">\tmFlag = FLAG_JIA;</span><br><span class=\"line\">\tUpdateData(FALSE);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">void</span> CCalculatorDlg::OnBnClickedButtonBack()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tUpdateData(TRUE);</span><br><span class=\"line\">\t<span class=\"comment\">//移除最右边一个字符    </span></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (!mStr.IsEmpty())</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tmStr = mStr.Left(mStr.GetLength() - <span class=\"number\">1</span>);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tUpdateData(FALSE);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//计算结果  </span></span><br><span class=\"line\"><span class=\"keyword\">void</span> CCalculatorDlg::Calculator()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tUpdateData(TRUE);</span><br><span class=\"line\">\tmNum2 = _wtof(mStr);</span><br><span class=\"line\">\t<span class=\"keyword\">double</span> result = <span class=\"number\">0.0f</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">switch</span> (mFlag)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">case</span> FLAG_JIA:                      <span class=\"comment\">//加    </span></span><br><span class=\"line\">\t\tresult = mNum1 + mNum2;</span><br><span class=\"line\">\t\t<span class=\"keyword\">break</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">case</span> FLAG_JIAN:                     <span class=\"comment\">//减   </span></span><br><span class=\"line\">\t\tresult = mNum1 - mNum2;</span><br><span class=\"line\">\t\t<span class=\"keyword\">break</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">case</span> FLAG_CHENG:                    <span class=\"comment\">//乘    </span></span><br><span class=\"line\">\t\tresult = mNum1 * mNum2;</span><br><span class=\"line\">\t\t<span class=\"keyword\">break</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">case</span> FLAG_CHU:                      <span class=\"comment\">//除    </span></span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (mNum2 == <span class=\"number\">0.0f</span>)</span><br><span class=\"line\">\t\t&#123;</span><br><span class=\"line\">\t\t\tresult = mNum1;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"keyword\">else</span></span><br><span class=\"line\">\t\t&#123;</span><br><span class=\"line\">\t\t\tresult = mNum1 / mNum2;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"keyword\">break</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">case</span> FLAG_PINGFANG:                 <span class=\"comment\">//平方   </span></span><br><span class=\"line\">\t\tresult = mNum2 * mNum2;</span><br><span class=\"line\">\t\t<span class=\"keyword\">break</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">case</span> FLAG_KAIFANG:                  <span class=\"comment\">//开方    </span></span><br><span class=\"line\">\t\tresult = <span class=\"built_in\">sqrt</span>(mNum2);</span><br><span class=\"line\">\t\t<span class=\"keyword\">break</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">default</span>:</span><br><span class=\"line\">\t\t<span class=\"keyword\">break</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"comment\">//如果浮点数其实是个整数,就显示为整数  </span></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (result - <span class=\"keyword\">int</span>(result) &lt;= <span class=\"number\">1e-5</span>)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tmStr.Format(<span class=\"string\">L\"%d\"</span>, (<span class=\"keyword\">int</span>)result);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">else</span></span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tmStr.Format(<span class=\"string\">L\"%f\"</span>, result);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tUpdateData(FALSE);</span><br><span class=\"line\"></span><br><span class=\"line\">\tmNum1 = result;</span><br><span class=\"line\">\tmNum2 = <span class=\"number\">0.0f</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">void</span> CCalculatorDlg::SaveFirstValue()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tUpdateData(TRUE);</span><br><span class=\"line\">\tmNum1 = _wtof(mStr);</span><br><span class=\"line\">\tmStr = <span class=\"string\">L\"\"</span>;</span><br><span class=\"line\">\tUpdateData(FALSE);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">void</span> CCalculatorDlg::OnEnChangeEdit1()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>","categories":[],"tags":[{"name":"MFC","path":"api/tags/MFC.json"}]}