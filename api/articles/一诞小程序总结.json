{"title":"一诞小程序总结","slug":"一诞小程序总结","date":"2018-12-27T04:47:45.000Z","updated":"2018-12-27T05:01:53.140Z","comments":true,"path":"api/articles/一诞小程序总结.json","excerpt":null,"covers":["https://blogimg-1252809090.cos.ap-chengdu.myqcloud.com/Christmas/Christmas_data.jpg","https://blogimg-1252809090.cos.ap-chengdu.myqcloud.com/Christmas/Christmas_qrcode.jpg"],"content":"<h2 id=\"介绍\"><a href=\"#介绍\" class=\"headerlink\" title=\"介绍\"></a>介绍</h2><p>一诞是一款基于腾讯云的人脸识别、五官定位的圣诞主题小程序。开始做它的初衷是为了简化用户操作，与其他手动添加帽子的小程序形成差别，所见即所得。<br>但是在开发的适合遇到了一些问题，没有完美的方案来根据五官定位API返回的坐标点来准确的给人物戴上帽子。<br>最后无奈之下就加入了圣诞贺卡的功能，弱化了生成头像的功能。<br>小程序全部功能使用云开发，大大减少了一个人的工作量。</p>\n<h2 id=\"贺卡功能介绍\"><a href=\"#贺卡功能介绍\" class=\"headerlink\" title=\"贺卡功能介绍\"></a>贺卡功能介绍</h2><p>贺卡是我在初中、小学的时候，圣诞最常送的礼物。小程序的转发恰好是赠送贺卡的最好入口，再加上一些抖音的模式。每个用户转发赠送的贺卡内容都会上传（这里忘记征求用户同意），在主页就可以使用摇一摇的方式来查看下一条贺卡内容，并且可以点赞。</p>\n<h2 id=\"五官定位戴帽子\"><a href=\"#五官定位戴帽子\" class=\"headerlink\" title=\"五官定位戴帽子\"></a>五官定位戴帽子</h2><p>五官定位使用的是腾讯云的API，它可以返回五官的坐标，<a href=\"https://cloud.tencent.com/document/product/867/17585\" target=\"_blank\" rel=\"noopener\">了解更多</a>。这里使用云函数可以快速的拿到返回参数，将坐标点绘制在画布上。</p>\n<h4 id=\"安装依赖\"><a href=\"#安装依赖\" class=\"headerlink\" title=\"安装依赖\"></a>安装依赖</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm i --save image-node-sdk</span><br></pre></td></tr></table></figure>\n<h4 id=\"云函数调用五官定位API\"><a href=\"#云函数调用五官定位API\" class=\"headerlink\" title=\"云函数调用五官定位API\"></a>云函数调用五官定位API</h4><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 云函数入口文件</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> cloud = <span class=\"built_in\">require</span>(<span class=\"string\">'wx-server-sdk'</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> &#123;ImageClient&#125; = <span class=\"built_in\">require</span>(<span class=\"string\">'image-node-sdk'</span>);</span><br><span class=\"line\"><span class=\"keyword\">let</span> AppId = <span class=\"string\">''</span>; <span class=\"comment\">// 腾讯云 AppId</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> SecretId = <span class=\"string\">''</span>; <span class=\"comment\">// 腾讯云 SecretId</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> SecretKey = <span class=\"string\">''</span>; <span class=\"comment\">// 腾讯云 SecretKey</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> imgClient = <span class=\"keyword\">new</span> ImageClient(&#123;</span><br><span class=\"line\">  AppId,</span><br><span class=\"line\">  SecretId,</span><br><span class=\"line\">  SecretKey</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\">cloud.init()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 云函数入口函数</span></span><br><span class=\"line\">exports.main = <span class=\"keyword\">async</span>(event, context) =&gt; &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> url = event.url;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> result = <span class=\"keyword\">await</span> imgClient.faceShape(&#123;</span><br><span class=\"line\">    data: &#123;</span><br><span class=\"line\">      appid: AppId,</span><br><span class=\"line\">      mode: <span class=\"number\">1</span>,</span><br><span class=\"line\">      url,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"built_in\">JSON</span>.parse(result.body);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><img src=\"https://blogimg-1252809090.cos.ap-chengdu.myqcloud.com/Christmas/Christmas_data.jpg\" alt=\"五官定位模型\"></p>\n<p>接下来就是根据坐标来准确戴帽子了，但是我能力有限，没有一套比较好的方案，只有在正脸情况下能够准确戴上帽子。帽子也是根据坐标点画出来的，非提前画好的图。如果你有好的想法欢迎联系我（WeChat：tysb7_)</p>\n<p><img src=\"https://blogimg-1252809090.cos.ap-chengdu.myqcloud.com/Christmas/Christmas_qrcode.jpg\" alt></p>\n<h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><p>这款小程序初衷是为了学习使用腾讯云人脸识别API，定位是为了蹭热度。但是时间、推广和能力的原因没能打造成一个爆款。不过在从中收获了许多东西，源码已经上传至GitHub，欢迎大家一起来维护。</p>\n<p>GitHub: <a href=\"https://github.com/tysb7/Christmas\" target=\"_blank\" rel=\"noopener\">本文项目仓库</a><br>WeChat: tysb7_<br>blog: <a href=\"https://www.tysb7.cn/\" target=\"_blank\" rel=\"noopener\">www.tysb7.cn</a><br>Email: <a href=\"mailto:&#116;&#101;&#x72;&#114;&#121;&#64;&#x71;&#x69;&#x61;&#111;&#107;&#114;&#46;&#x63;&#111;&#109;\" target=\"_blank\" rel=\"noopener\">&#116;&#101;&#x72;&#114;&#121;&#64;&#x71;&#x69;&#x61;&#111;&#107;&#114;&#46;&#x63;&#111;&#109;</a><br>SSl: <a href=\"https://www.trustocean.com/\" target=\"_blank\" rel=\"noopener\">环洋诚信™</a></p>\n","more":"<h2 id=\"介绍\"><a href=\"#介绍\" class=\"headerlink\" title=\"介绍\"></a>介绍</h2><p>一诞是一款基于腾讯云的人脸识别、五官定位的圣诞主题小程序。开始做它的初衷是为了简化用户操作，与其他手动添加帽子的小程序形成差别，所见即所得。<br>但是在开发的适合遇到了一些问题，没有完美的方案来根据五官定位API返回的坐标点来准确的给人物戴上帽子。<br>最后无奈之下就加入了圣诞贺卡的功能，弱化了生成头像的功能。<br>小程序全部功能使用云开发，大大减少了一个人的工作量。</p>\n<h2 id=\"贺卡功能介绍\"><a href=\"#贺卡功能介绍\" class=\"headerlink\" title=\"贺卡功能介绍\"></a>贺卡功能介绍</h2><p>贺卡是我在初中、小学的时候，圣诞最常送的礼物。小程序的转发恰好是赠送贺卡的最好入口，再加上一些抖音的模式。每个用户转发赠送的贺卡内容都会上传（这里忘记征求用户同意），在主页就可以使用摇一摇的方式来查看下一条贺卡内容，并且可以点赞。</p>\n<h2 id=\"五官定位戴帽子\"><a href=\"#五官定位戴帽子\" class=\"headerlink\" title=\"五官定位戴帽子\"></a>五官定位戴帽子</h2><p>五官定位使用的是腾讯云的API，它可以返回五官的坐标，<a href=\"https://cloud.tencent.com/document/product/867/17585\" target=\"_blank\" rel=\"noopener\">了解更多</a>。这里使用云函数可以快速的拿到返回参数，将坐标点绘制在画布上。</p>\n<h4 id=\"安装依赖\"><a href=\"#安装依赖\" class=\"headerlink\" title=\"安装依赖\"></a>安装依赖</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm i --save image-node-sdk</span><br></pre></td></tr></table></figure>\n<h4 id=\"云函数调用五官定位API\"><a href=\"#云函数调用五官定位API\" class=\"headerlink\" title=\"云函数调用五官定位API\"></a>云函数调用五官定位API</h4><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 云函数入口文件</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> cloud = <span class=\"built_in\">require</span>(<span class=\"string\">'wx-server-sdk'</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> &#123;ImageClient&#125; = <span class=\"built_in\">require</span>(<span class=\"string\">'image-node-sdk'</span>);</span><br><span class=\"line\"><span class=\"keyword\">let</span> AppId = <span class=\"string\">''</span>; <span class=\"comment\">// 腾讯云 AppId</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> SecretId = <span class=\"string\">''</span>; <span class=\"comment\">// 腾讯云 SecretId</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> SecretKey = <span class=\"string\">''</span>; <span class=\"comment\">// 腾讯云 SecretKey</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> imgClient = <span class=\"keyword\">new</span> ImageClient(&#123;</span><br><span class=\"line\">  AppId,</span><br><span class=\"line\">  SecretId,</span><br><span class=\"line\">  SecretKey</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\">cloud.init()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 云函数入口函数</span></span><br><span class=\"line\">exports.main = <span class=\"keyword\">async</span>(event, context) =&gt; &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> url = event.url;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> result = <span class=\"keyword\">await</span> imgClient.faceShape(&#123;</span><br><span class=\"line\">    data: &#123;</span><br><span class=\"line\">      appid: AppId,</span><br><span class=\"line\">      mode: <span class=\"number\">1</span>,</span><br><span class=\"line\">      url,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"built_in\">JSON</span>.parse(result.body);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><img src=\"https://blogimg-1252809090.cos.ap-chengdu.myqcloud.com/Christmas/Christmas_data.jpg\" alt=\"五官定位模型\"></p>\n<p>接下来就是根据坐标来准确戴帽子了，但是我能力有限，没有一套比较好的方案，只有在正脸情况下能够准确戴上帽子。帽子也是根据坐标点画出来的，非提前画好的图。如果你有好的想法欢迎联系我（WeChat：tysb7_)</p>\n<p><img src=\"https://blogimg-1252809090.cos.ap-chengdu.myqcloud.com/Christmas/Christmas_qrcode.jpg\" alt></p>\n<h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><p>这款小程序初衷是为了学习使用腾讯云人脸识别API，定位是为了蹭热度。但是时间、推广和能力的原因没能打造成一个爆款。不过在从中收获了许多东西，源码已经上传至GitHub，欢迎大家一起来维护。</p>\n<p>GitHub: <a href=\"https://github.com/tysb7/Christmas\" target=\"_blank\" rel=\"noopener\">本文项目仓库</a><br>WeChat: tysb7_<br>blog: <a href=\"https://www.tysb7.cn/\" target=\"_blank\" rel=\"noopener\">www.tysb7.cn</a><br>Email: <a href=\"mailto:&#116;&#101;&#x72;&#114;&#121;&#64;&#x71;&#x69;&#x61;&#111;&#107;&#114;&#46;&#x63;&#111;&#109;\" target=\"_blank\" rel=\"noopener\">&#116;&#101;&#x72;&#114;&#121;&#64;&#x71;&#x69;&#x61;&#111;&#107;&#114;&#46;&#x63;&#111;&#109;</a><br>SSl: <a href=\"https://www.trustocean.com/\" target=\"_blank\" rel=\"noopener\">环洋诚信™</a></p>\n","categories":[],"tags":[]}