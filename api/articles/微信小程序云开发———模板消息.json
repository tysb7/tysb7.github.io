{"title":"微信小程序云开发模板消息(官方版)","slug":"微信小程序云开发———模板消息","date":"2018-09-16T09:27:43.000Z","updated":"2018-12-20T09:29:23.933Z","comments":true,"path":"api/articles/微信小程序云开发———模板消息.json","excerpt":null,"covers":["https://blogimg-1252809090.cos.ap-chengdu.myqcloud.com/WeChat_miniapp_template_chat/1.png"],"content":"<h2 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h2><p>9月11日，在申请内测名额无果后，终于微信小程序云开发公测了！本文是我在<a href=\"https://cloud.tencent.com/document/product/876/19532#.E6.89.8B.E5.8A.A8.E9.83.A8.E7.BD.B2\" target=\"_blank\" rel=\"noopener\">腾讯云官网</a>学习之后做出的总结。</p>\n<h2 id=\"微信小程序云开发是什么\"><a href=\"#微信小程序云开发是什么\" class=\"headerlink\" title=\"微信小程序云开发是什么\"></a>微信小程序云开发是什么</h2><p>开发者可以使用云开发开发微信小程序、小游戏，无需搭建服务器，即可使用云端能力。<br>云开发为开发者提供完整的云端支持，弱化后端和运维概念，无需搭建服务器，使用平台提供的 API 进行核心业务开发，即可实现快速上线和迭代，同时这一能力，同开发者已经使用的云服务相互兼容，并不互斥。<br>目前提供三大基础能力支持：</p>\n<ul>\n<li>云函数：在云端运行的代码，微信私有协议天然鉴权，开发者只需编写自身业务逻辑代码</li>\n<li>数据库：一个既可在小程序前端操作，也能在云函数中读写的 JSON 数据库</li>\n<li>存储：在小程序前端直接上传/下载云端文件，在云开发控制台可视化管理</li>\n</ul>\n<p>具体内容可以去官网看：<a href=\"https://developers.weixin.qq.com/miniprogram/dev/wxcloud/basis/getting-started.html\" target=\"_blank\" rel=\"noopener\">官网</a></p>\n<h2 id=\"小程序模板消息DEMO\"><a href=\"#小程序模板消息DEMO\" class=\"headerlink\" title=\"小程序模板消息DEMO\"></a>小程序模板消息DEMO</h2><p><a href=\"https://cloud.tencent.com/document/product/876/19532#.E6.89.8B.E5.8A.A8.E9.83.A8.E7.BD.B2\" target=\"_blank\" rel=\"noopener\">原文地址</a></p>\n<p>1.Clone项目</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git clone https://github.com/TencentCloudBase/tcb-demo-message.git</span><br></pre></td></tr></table></figure>\n<p>2.项目结构</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">project</span><br><span class=\"line\"> ├── client               # 客户端代码</span><br><span class=\"line\"> │    ├── lib             # 外部库</span><br><span class=\"line\"> │    ├── pages           # demo 页面</span><br><span class=\"line\"> │    ├── components      # 消息组件代码</span><br><span class=\"line\"> │    └── utils           # 工具</span><br><span class=\"line\"> ├── cloud                # 腾讯云服务相关文件</span><br><span class=\"line\"> │    └── functions       # 云函数</span><br><span class=\"line\"> ├── config               # 配置文件</span><br><span class=\"line\"> ├── server               # 服务端代码</span><br><span class=\"line\"> └── project.config.json  # 项目配置文件</span><br></pre></td></tr></table></figure>\n<p>3.拷贝文件</p>\n<p>将/cloud/functions/wxmessage中所有文件拷贝到你的云函数中</p>\n<p><img src=\"https://blogimg-1252809090.cos.ap-chengdu.myqcloud.com/WeChat_miniapp_template_chat/1.png\" alt></p>\n<p>4.修改配置</p>\n<p>cloud/functions/wxmessage/index.js</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">const secret = &apos;secret&apos; // 小程序 Appsecret ，后台可以查询到</span><br><span class=\"line\">const templateId = &apos;template_id&apos; // 模板 id，不建议填写，可以从小程序端传送</span><br></pre></td></tr></table></figure>\n<p>5.安装依赖并部署</p>\n<p>在云函数函数wxmessage目录下安装依赖，并用右击部署</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ npm install</span><br></pre></td></tr></table></figure>\n<p>6.小程序端加入调用云函数代码</p>\n<p>WXML中使用from组建即可</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">wx.cloud.callFunction(&#123;</span><br><span class=\"line\">  name: <span class=\"string\">'wxmessage'</span>, <span class=\"comment\">//云函数名</span></span><br><span class=\"line\">  data: &#123;</span><br><span class=\"line\">    code: <span class=\"string\">''</span>,</span><br><span class=\"line\">    templateId: <span class=\"string\">''</span>, <span class=\"comment\">//模板消息ID，可以在公众号后台创建并查询</span></span><br><span class=\"line\">    formId: formId,</span><br><span class=\"line\">    data: &#123;</span><br><span class=\"line\">      keyword1: &#123;</span><br><span class=\"line\">        value: <span class=\"string\">'xxx'</span></span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      keyword2: &#123;</span><br><span class=\"line\">        value: <span class=\"string\">'xxx'</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">&#125;).then(<span class=\"function\">(<span class=\"params\">res</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(res);</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (res.result &amp;&amp; res.result.data &amp;&amp; res.result.data.errcode === <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">    wx.showToast(&#123;</span><br><span class=\"line\">      title: <span class=\"string\">'报名成功'</span>,</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    wx.showToast(&#123;</span><br><span class=\"line\">      title: <span class=\"string\">'报名失败'</span>,</span><br><span class=\"line\">      icon: <span class=\"string\">'none'</span></span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>属性</p>\n<table>\n<thead>\n<tr>\n<th>属性名</th>\n<th>含义</th>\n<th>数据类型</th>\n<th>必填</th>\n<th>默认值</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>code</td>\n<td>用户登录凭证，用于openId拿不到的情况</td>\n<td>String</td>\n<td>否</td>\n<td>- </td>\n</tr>\n<tr>\n<td>formId</td>\n<td>表单提交中携带的 from_id</td>\n<td>String</td>\n<td>否</td>\n<td>- </td>\n</tr>\n<tr>\n<td>prepayId</td>\n<td>支付场景中的 prepayId，formId和prepayId二选一</td>\n<td>String</td>\n<td>否</td>\n<td>- </td>\n</tr>\n<tr>\n<td>data</td>\n<td>模板内容</td>\n<td>Object</td>\n<td>是</td>\n<td>- </td>\n</tr>\n<tr>\n<td>page</td>\n<td>点击模板卡片后的跳转页</td>\n<td>String</td>\n<td>否</td>\n<td>- </td>\n</tr>\n<tr>\n<td>templateId</td>\n<td>模板 id</td>\n<td>String</td>\n<td>否</td>\n<td>- </td>\n</tr>\n</tbody>\n</table>\n<h1 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h1><blockquote>\n<p>小程序云开发的加入，极大的方便了前端开发者，小项目不再需要后端GG了，很适合初学者一个人做项目。<br>这里我直接将次函数引入自己的项目中，发送给云函数的参数都是在js中定义的，前端使用button套from组件完成的。<br>在不同场景中只需要改变Js中改变templateId的参数即可。<br>最后还有想要button组件去掉边框，只需在css中加入button::after{border: 0;}就好了。</p>\n</blockquote>\n","more":"<h2 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h2><p>9月11日，在申请内测名额无果后，终于微信小程序云开发公测了！本文是我在<a href=\"https://cloud.tencent.com/document/product/876/19532#.E6.89.8B.E5.8A.A8.E9.83.A8.E7.BD.B2\" target=\"_blank\" rel=\"noopener\">腾讯云官网</a>学习之后做出的总结。</p>\n<h2 id=\"微信小程序云开发是什么\"><a href=\"#微信小程序云开发是什么\" class=\"headerlink\" title=\"微信小程序云开发是什么\"></a>微信小程序云开发是什么</h2><p>开发者可以使用云开发开发微信小程序、小游戏，无需搭建服务器，即可使用云端能力。<br>云开发为开发者提供完整的云端支持，弱化后端和运维概念，无需搭建服务器，使用平台提供的 API 进行核心业务开发，即可实现快速上线和迭代，同时这一能力，同开发者已经使用的云服务相互兼容，并不互斥。<br>目前提供三大基础能力支持：</p>\n<ul>\n<li>云函数：在云端运行的代码，微信私有协议天然鉴权，开发者只需编写自身业务逻辑代码</li>\n<li>数据库：一个既可在小程序前端操作，也能在云函数中读写的 JSON 数据库</li>\n<li>存储：在小程序前端直接上传/下载云端文件，在云开发控制台可视化管理</li>\n</ul>\n<p>具体内容可以去官网看：<a href=\"https://developers.weixin.qq.com/miniprogram/dev/wxcloud/basis/getting-started.html\" target=\"_blank\" rel=\"noopener\">官网</a></p>\n<h2 id=\"小程序模板消息DEMO\"><a href=\"#小程序模板消息DEMO\" class=\"headerlink\" title=\"小程序模板消息DEMO\"></a>小程序模板消息DEMO</h2><p><a href=\"https://cloud.tencent.com/document/product/876/19532#.E6.89.8B.E5.8A.A8.E9.83.A8.E7.BD.B2\" target=\"_blank\" rel=\"noopener\">原文地址</a></p>\n<p>1.Clone项目</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git clone https://github.com/TencentCloudBase/tcb-demo-message.git</span><br></pre></td></tr></table></figure>\n<p>2.项目结构</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">project</span><br><span class=\"line\"> ├── client               # 客户端代码</span><br><span class=\"line\"> │    ├── lib             # 外部库</span><br><span class=\"line\"> │    ├── pages           # demo 页面</span><br><span class=\"line\"> │    ├── components      # 消息组件代码</span><br><span class=\"line\"> │    └── utils           # 工具</span><br><span class=\"line\"> ├── cloud                # 腾讯云服务相关文件</span><br><span class=\"line\"> │    └── functions       # 云函数</span><br><span class=\"line\"> ├── config               # 配置文件</span><br><span class=\"line\"> ├── server               # 服务端代码</span><br><span class=\"line\"> └── project.config.json  # 项目配置文件</span><br></pre></td></tr></table></figure>\n<p>3.拷贝文件</p>\n<p>将/cloud/functions/wxmessage中所有文件拷贝到你的云函数中</p>\n<p><img src=\"https://blogimg-1252809090.cos.ap-chengdu.myqcloud.com/WeChat_miniapp_template_chat/1.png\" alt></p>\n<p>4.修改配置</p>\n<p>cloud/functions/wxmessage/index.js</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">const secret = &apos;secret&apos; // 小程序 Appsecret ，后台可以查询到</span><br><span class=\"line\">const templateId = &apos;template_id&apos; // 模板 id，不建议填写，可以从小程序端传送</span><br></pre></td></tr></table></figure>\n<p>5.安装依赖并部署</p>\n<p>在云函数函数wxmessage目录下安装依赖，并用右击部署</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ npm install</span><br></pre></td></tr></table></figure>\n<p>6.小程序端加入调用云函数代码</p>\n<p>WXML中使用from组建即可</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">wx.cloud.callFunction(&#123;</span><br><span class=\"line\">  name: <span class=\"string\">'wxmessage'</span>, <span class=\"comment\">//云函数名</span></span><br><span class=\"line\">  data: &#123;</span><br><span class=\"line\">    code: <span class=\"string\">''</span>,</span><br><span class=\"line\">    templateId: <span class=\"string\">''</span>, <span class=\"comment\">//模板消息ID，可以在公众号后台创建并查询</span></span><br><span class=\"line\">    formId: formId,</span><br><span class=\"line\">    data: &#123;</span><br><span class=\"line\">      keyword1: &#123;</span><br><span class=\"line\">        value: <span class=\"string\">'xxx'</span></span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      keyword2: &#123;</span><br><span class=\"line\">        value: <span class=\"string\">'xxx'</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">&#125;).then(<span class=\"function\">(<span class=\"params\">res</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(res);</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (res.result &amp;&amp; res.result.data &amp;&amp; res.result.data.errcode === <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">    wx.showToast(&#123;</span><br><span class=\"line\">      title: <span class=\"string\">'报名成功'</span>,</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    wx.showToast(&#123;</span><br><span class=\"line\">      title: <span class=\"string\">'报名失败'</span>,</span><br><span class=\"line\">      icon: <span class=\"string\">'none'</span></span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>属性</p>\n<table>\n<thead>\n<tr>\n<th>属性名</th>\n<th>含义</th>\n<th>数据类型</th>\n<th>必填</th>\n<th>默认值</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>code</td>\n<td>用户登录凭证，用于openId拿不到的情况</td>\n<td>String</td>\n<td>否</td>\n<td>- </td>\n</tr>\n<tr>\n<td>formId</td>\n<td>表单提交中携带的 from_id</td>\n<td>String</td>\n<td>否</td>\n<td>- </td>\n</tr>\n<tr>\n<td>prepayId</td>\n<td>支付场景中的 prepayId，formId和prepayId二选一</td>\n<td>String</td>\n<td>否</td>\n<td>- </td>\n</tr>\n<tr>\n<td>data</td>\n<td>模板内容</td>\n<td>Object</td>\n<td>是</td>\n<td>- </td>\n</tr>\n<tr>\n<td>page</td>\n<td>点击模板卡片后的跳转页</td>\n<td>String</td>\n<td>否</td>\n<td>- </td>\n</tr>\n<tr>\n<td>templateId</td>\n<td>模板 id</td>\n<td>String</td>\n<td>否</td>\n<td>- </td>\n</tr>\n</tbody>\n</table>\n<h1 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h1><blockquote>\n<p>小程序云开发的加入，极大的方便了前端开发者，小项目不再需要后端GG了，很适合初学者一个人做项目。<br>这里我直接将次函数引入自己的项目中，发送给云函数的参数都是在js中定义的，前端使用button套from组件完成的。<br>在不同场景中只需要改变Js中改变templateId的参数即可。<br>最后还有想要button组件去掉边框，只需在css中加入button::after{border: 0;}就好了。</p>\n</blockquote>\n","categories":[],"tags":[{"name":"微信小程序","path":"api/tags/微信小程序.json"}]}