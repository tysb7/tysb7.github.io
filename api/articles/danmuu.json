{"title":"微信小程序类弹幕祝福","slug":"danmuu","date":"2018-09-03T11:14:35.000Z","updated":"2018-11-28T03:39:03.704Z","comments":true,"path":"api/articles/danmuu.json","excerpt":null,"covers":null,"content":"<h3 id=\"想法\"><a href=\"#想法\" class=\"headerlink\" title=\"想法\"></a>想法</h3><hr>\n<p>学校校庆在即，突然有了做一个校友发送祝福的功能，正好最近复习了Js的基础，趁热打铁练练手吧。<br>因为主要的功能是发送祝福，所以不像各大直播平台的实时弹幕，这样一来也就简单的多了。<br>只需要用户发送祝福，将祝福信息存储到数据库，然后加载页面时将祝福信息列表循环 显示出来就好了。</p>\n<h3 id=\"重点\"><a href=\"#重点\" class=\"headerlink\" title=\"重点\"></a>重点</h3><hr>\n<p> 1.使用定时器和取消定时器</p>\n<p> 设置1500ms的定时：<br> <figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">this</span>.data.Interval = setInterval(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">      XXX</span><br><span class=\"line\">    &#125;, <span class=\"number\">1500</span>)</span><br></pre></td></tr></table></figure></p>\n<p>取消定时：<br> <figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">clearTimeout(<span class=\"keyword\">this</span>.data.Interval);</span><br></pre></td></tr></table></figure></p>\n<p> 2.使用腾讯地图API逆地址解析</p>\n <figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 引入SDK核心类</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> QQMapWX = <span class=\"built_in\">require</span>(<span class=\"string\">'xxx/qqmap-wx.js'</span>);</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"comment\">// 实例化API核心类</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> demo = <span class=\"keyword\">new</span> QQMapWX(&#123;</span><br><span class=\"line\">    key: <span class=\"string\">'开发密钥（key）'</span> <span class=\"comment\">// 必填</span></span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"comment\">// 调用接口</span></span><br><span class=\"line\">demo.reverseGeocoder(&#123;</span><br><span class=\"line\">    location: &#123;</span><br><span class=\"line\">        latitude: <span class=\"number\">39.984060</span>,</span><br><span class=\"line\">        longitude: <span class=\"number\">116.307520</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    success: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">res</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(res);</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    fail: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">res</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(res);</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    complete: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">res</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(res);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<h3 id=\"代码\"><a href=\"#代码\" class=\"headerlink\" title=\"代码\"></a>代码</h3><hr>\n<p>index.js<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br><span class=\"line\">245</span><br><span class=\"line\">246</span><br><span class=\"line\">247</span><br><span class=\"line\">248</span><br><span class=\"line\">249</span><br><span class=\"line\">250</span><br><span class=\"line\">251</span><br><span class=\"line\">252</span><br><span class=\"line\">253</span><br><span class=\"line\">254</span><br><span class=\"line\">255</span><br><span class=\"line\">256</span><br><span class=\"line\">257</span><br><span class=\"line\">258</span><br><span class=\"line\">259</span><br><span class=\"line\">260</span><br><span class=\"line\">261</span><br><span class=\"line\">262</span><br><span class=\"line\">263</span><br><span class=\"line\">264</span><br><span class=\"line\">265</span><br><span class=\"line\">266</span><br><span class=\"line\">267</span><br><span class=\"line\">268</span><br><span class=\"line\">269</span><br><span class=\"line\">270</span><br><span class=\"line\">271</span><br><span class=\"line\">272</span><br><span class=\"line\">273</span><br><span class=\"line\">274</span><br><span class=\"line\">275</span><br><span class=\"line\">276</span><br><span class=\"line\">277</span><br><span class=\"line\">278</span><br><span class=\"line\">279</span><br><span class=\"line\">280</span><br><span class=\"line\">281</span><br><span class=\"line\">282</span><br><span class=\"line\">283</span><br><span class=\"line\">284</span><br><span class=\"line\">285</span><br><span class=\"line\">286</span><br><span class=\"line\">287</span><br><span class=\"line\">288</span><br><span class=\"line\">289</span><br><span class=\"line\">290</span><br><span class=\"line\">291</span><br><span class=\"line\">292</span><br><span class=\"line\">293</span><br><span class=\"line\">294</span><br><span class=\"line\">295</span><br><span class=\"line\">296</span><br><span class=\"line\">297</span><br><span class=\"line\">298</span><br><span class=\"line\">299</span><br><span class=\"line\">300</span><br><span class=\"line\">301</span><br><span class=\"line\">302</span><br><span class=\"line\">303</span><br><span class=\"line\">304</span><br><span class=\"line\">305</span><br><span class=\"line\">306</span><br><span class=\"line\">307</span><br><span class=\"line\">308</span><br><span class=\"line\">309</span><br><span class=\"line\">310</span><br><span class=\"line\">311</span><br><span class=\"line\">312</span><br><span class=\"line\">313</span><br><span class=\"line\">314</span><br><span class=\"line\">315</span><br><span class=\"line\">316</span><br><span class=\"line\">317</span><br><span class=\"line\">318</span><br><span class=\"line\">319</span><br><span class=\"line\">320</span><br><span class=\"line\">321</span><br><span class=\"line\">322</span><br><span class=\"line\">323</span><br><span class=\"line\">324</span><br><span class=\"line\">325</span><br><span class=\"line\">326</span><br><span class=\"line\">327</span><br><span class=\"line\">328</span><br><span class=\"line\">329</span><br><span class=\"line\">330</span><br><span class=\"line\">331</span><br><span class=\"line\">332</span><br><span class=\"line\">333</span><br><span class=\"line\">334</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//index.js</span></span><br><span class=\"line\"><span class=\"comment\">// 引入腾讯地图SDK核心类</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> QQMapWX = <span class=\"built_in\">require</span>(<span class=\"string\">'../../utils/qqmap-wx-jssdk.js'</span>);</span><br><span class=\"line\"><span class=\"comment\">// 实例化API核心类</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> demo = <span class=\"keyword\">new</span> QQMapWX(&#123;</span><br><span class=\"line\">  key: <span class=\"string\">'****'</span> <span class=\"comment\">// 必填</span></span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"><span class=\"keyword\">const</span> app = getApp()</span><br><span class=\"line\"><span class=\"keyword\">var</span> page = <span class=\"literal\">undefined</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> doommList = [];</span><br><span class=\"line\"><span class=\"keyword\">var</span> i = <span class=\"number\">0</span>;</span><br><span class=\"line\"><span class=\"comment\">//设置数组</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Doomm</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">constructor</span>(text, top, time, color) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.text = text;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.top = top;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.time = time;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.color = color;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.display = <span class=\"literal\">true</span>;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> that = <span class=\"keyword\">this</span>;</span><br><span class=\"line\">    setTimeout(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">      doommList.splice(doommList.indexOf(that), <span class=\"number\">1</span>);</span><br><span class=\"line\">      page.setData(&#123;</span><br><span class=\"line\">        doommData: doommList,</span><br><span class=\"line\">      &#125;)</span><br><span class=\"line\">    &#125;, <span class=\"keyword\">this</span>.time * <span class=\"number\">10000</span>)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//随机颜色</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getRandomColor</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> rgb = []</span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">3</span>; ++i) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> color = <span class=\"built_in\">Math</span>.floor(<span class=\"built_in\">Math</span>.random() * <span class=\"number\">256</span>).toString(<span class=\"number\">16</span>)</span><br><span class=\"line\">    color = color.length == <span class=\"number\">1</span> ? <span class=\"string\">'0'</span> + color : color</span><br><span class=\"line\">    rgb.push(color)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"string\">'#'</span> + rgb.join(<span class=\"string\">''</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">Page(&#123;</span><br><span class=\"line\">  data: &#123;</span><br><span class=\"line\">    doommData: [],</span><br><span class=\"line\">    usrdoommData: [],</span><br><span class=\"line\">    Interval: <span class=\"string\">''</span>,</span><br><span class=\"line\">    danmuinfo: <span class=\"string\">''</span>,</span><br><span class=\"line\">    senddisabled: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    placeholderinfo: <span class=\"string\">'培华九十岁生日快乐！'</span>,</span><br><span class=\"line\">    GotUserInfohidden: <span class=\"literal\">false</span>,<span class=\"comment\">//设置登陆button隐藏</span></span><br><span class=\"line\">    city:<span class=\"string\">''</span>,<span class=\"comment\">//用户所在城市</span></span><br><span class=\"line\">    add:<span class=\"string\">''</span><span class=\"comment\">//用户地点</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  onLoad: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    page = <span class=\"keyword\">this</span>;</span><br><span class=\"line\">    wx.showShareMenu(&#123;</span><br><span class=\"line\">      withShareTicket: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    <span class=\"comment\">//获取用户坐标</span></span><br><span class=\"line\">    wx.getLocation(&#123;</span><br><span class=\"line\">      type: <span class=\"string\">'wgs84'</span>,</span><br><span class=\"line\">      success: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">res</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(res)</span><br><span class=\"line\">        <span class=\"keyword\">var</span> latitude = res.latitude</span><br><span class=\"line\">        <span class=\"keyword\">var</span> longitude = res.longitude</span><br><span class=\"line\">        <span class=\"keyword\">var</span> speed = res.speed</span><br><span class=\"line\">        <span class=\"keyword\">var</span> accuracy = res.accuracy</span><br><span class=\"line\">        <span class=\"comment\">// 调用接口反编译地点信息</span></span><br><span class=\"line\">        demo.reverseGeocoder(&#123;</span><br><span class=\"line\">          location: &#123;</span><br><span class=\"line\">            latitude: res.latitude,</span><br><span class=\"line\">            longitude: res.longitude</span><br><span class=\"line\">          &#125;,</span><br><span class=\"line\">          success: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">res</span>) </span>&#123;</span><br><span class=\"line\">            <span class=\"built_in\">console</span>.log(res.result.ad_info.city);</span><br><span class=\"line\">            page.setData(&#123;</span><br><span class=\"line\">              add: res.result,</span><br><span class=\"line\">              city: res.result.ad_info.city</span><br><span class=\"line\">            &#125;)</span><br><span class=\"line\">          &#125;,</span><br><span class=\"line\">          fail: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">res</span>) </span>&#123;</span><br><span class=\"line\">            <span class=\"built_in\">console</span>.log(res);</span><br><span class=\"line\">          &#125;,</span><br><span class=\"line\">          complete: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">res</span>) </span>&#123;</span><br><span class=\"line\">            <span class=\"built_in\">console</span>.log(res);</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      fail: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">res</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(res);</span><br><span class=\"line\">        wx.showToast(&#123;</span><br><span class=\"line\">          title: <span class=\"string\">'请使用位置访问！'</span>,</span><br><span class=\"line\">          icon: <span class=\"string\">'loading'</span>,</span><br><span class=\"line\">          duration: <span class=\"number\">2000</span></span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    wx.login(&#123;</span><br><span class=\"line\">      success: <span class=\"function\"><span class=\"params\">res</span> =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">//发送 res.code 到后台换取 openId, sessionKey, unionId</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (res.code) &#123;</span><br><span class=\"line\">          <span class=\"comment\">//console.log(res.code)</span></span><br><span class=\"line\">          <span class=\"keyword\">var</span> code = res.code; <span class=\"comment\">//返回code</span></span><br><span class=\"line\">          wx.request(&#123;</span><br><span class=\"line\">            url: <span class=\"string\">'***'</span>,</span><br><span class=\"line\">            method: <span class=\"string\">\"GET\"</span>,</span><br><span class=\"line\">            data: &#123;</span><br><span class=\"line\">              code: code</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            header: &#123;</span><br><span class=\"line\">              <span class=\"string\">'content-type'</span>: <span class=\"string\">'application/x-www-form-urlencoded'</span></span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            success: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">res</span>) </span>&#123;</span><br><span class=\"line\">              <span class=\"built_in\">console</span>.log(res.data)</span><br><span class=\"line\">              wx.setStorageSync(<span class=\"string\">\"openid\"</span>, res.data)</span><br><span class=\"line\"></span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            fail: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">res</span>) </span>&#123;</span><br><span class=\"line\">              <span class=\"comment\">//失败回调</span></span><br><span class=\"line\">              <span class=\"built_in\">console</span>.log(res)</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">          &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    <span class=\"comment\">//判断用户是否登陆</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (wx.getStorageSync(<span class=\"string\">'GotUserInfo'</span>) == <span class=\"literal\">true</span>) &#123;</span><br><span class=\"line\">      page.setData(&#123;</span><br><span class=\"line\">        GotUserInfohidden: <span class=\"literal\">true</span></span><br><span class=\"line\">      &#125;)</span><br><span class=\"line\">      <span class=\"built_in\">console</span>.log(page.data.GotUserInfohidden)</span><br><span class=\"line\">      <span class=\"built_in\">console</span>.log(wx.getStorageInfoSync(<span class=\"string\">'GotUserInfo'</span>))</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">//获取数据库弹幕</span></span><br><span class=\"line\">    wx.request(&#123;</span><br><span class=\"line\">      url: <span class=\"string\">'***'</span>,</span><br><span class=\"line\">      method: <span class=\"string\">\"GET\"</span>,</span><br><span class=\"line\">      data: &#123;</span><br><span class=\"line\">        <span class=\"keyword\">switch</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      header: &#123;</span><br><span class=\"line\">        <span class=\"string\">\"content-type\"</span>: <span class=\"string\">\"application/x-www-form-urlencoded\"</span></span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      success: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">res</span>) </span>&#123;</span><br><span class=\"line\">        page.setData(&#123;</span><br><span class=\"line\">          danmu: res.data,</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(page.data.danmu);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> arr = []</span><br><span class=\"line\">        <span class=\"keyword\">var</span> i = <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"comment\">//定时一个一个push弹幕信息</span></span><br><span class=\"line\">        page.data.Interval = setInterval(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">          <span class=\"keyword\">if</span> (i &lt; page.data.danmu.length) &#123;</span><br><span class=\"line\">            i++;</span><br><span class=\"line\">            arr.push(page.data.danmu[i])</span><br><span class=\"line\">            <span class=\"comment\">//console.log(arr);</span></span><br><span class=\"line\">            page.setData(&#123;</span><br><span class=\"line\">              doommData: arr,</span><br><span class=\"line\">            &#125;)</span><br><span class=\"line\">          &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            i = <span class=\"number\">0</span>;</span><br><span class=\"line\">            wx.request(&#123;</span><br><span class=\"line\">              url: <span class=\"string\">'***'</span>,</span><br><span class=\"line\">              method: <span class=\"string\">\"GET\"</span>,</span><br><span class=\"line\">              data: &#123;</span><br><span class=\"line\">                <span class=\"keyword\">switch</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">              &#125;,</span><br><span class=\"line\">              header: &#123;</span><br><span class=\"line\">                <span class=\"string\">\"content-type\"</span>: <span class=\"string\">\"application/x-www-form-urlencoded\"</span></span><br><span class=\"line\">              &#125;,</span><br><span class=\"line\">              success: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">res</span>) </span>&#123;</span><br><span class=\"line\">                page.setData(&#123;</span><br><span class=\"line\">                  danmu: res.data,</span><br><span class=\"line\">                &#125;)</span><br><span class=\"line\">              &#125;,</span><br><span class=\"line\">              fail: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">res</span>) </span>&#123;</span><br><span class=\"line\">                <span class=\"built_in\">console</span>.log(res);</span><br><span class=\"line\">              &#125;</span><br><span class=\"line\">            &#125;)</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">          <span class=\"built_in\">console</span>.log(i)</span><br><span class=\"line\">        &#125;, <span class=\"number\">1500</span>)</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      fail: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">res</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(res);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"comment\">//发送弹幕祝福</span></span><br><span class=\"line\">  bindbt: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">e</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(e.detail.value)</span><br><span class=\"line\">    <span class=\"comment\">//当input失去焦点则调用函数发送</span></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.setData(&#123;</span><br><span class=\"line\">      danmuinfo: e.detail.value</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.data.danmuinfo !== <span class=\"string\">''</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.setData(&#123;</span><br><span class=\"line\">        senddisabled: <span class=\"literal\">false</span></span><br><span class=\"line\">      &#125;)</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.send();</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.setData(&#123;</span><br><span class=\"line\">        senddisabled: <span class=\"literal\">true</span></span><br><span class=\"line\">      &#125;)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  send: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">e</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> that = <span class=\"keyword\">this</span>;</span><br><span class=\"line\">    <span class=\"comment\">//console.log(that.data.add)</span></span><br><span class=\"line\">    <span class=\"comment\">//console.log(that.data.city)</span></span><br><span class=\"line\">    <span class=\"comment\">//如果弹幕不为空则将弹幕祝福push数组并赋给usrdoommData，显示用户当前发送弹幕祝福信息</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (that.data.danmuinfo !== <span class=\"string\">''</span>) &#123;</span><br><span class=\"line\">      doommList.push(<span class=\"keyword\">new</span> Doomm(wx.getStorageSync(<span class=\"string\">'UserInfo'</span>).nickName + <span class=\"string\">'在'</span> + that.data.city + <span class=\"string\">'祝培华'</span> + that.data.danmuinfo, <span class=\"built_in\">Math</span>.ceil(<span class=\"built_in\">Math</span>.random() * <span class=\"number\">100</span>), <span class=\"built_in\">Math</span>.ceil((<span class=\"built_in\">Math</span>.random() * <span class=\"number\">2</span>) + <span class=\"number\">15</span>), <span class=\"string\">'#000000'</span>));</span><br><span class=\"line\">      that.setData(&#123;</span><br><span class=\"line\">        usrdoommData: doommList,</span><br><span class=\"line\">      &#125;)</span><br><span class=\"line\">      <span class=\"built_in\">console</span>.log(doommList);</span><br><span class=\"line\">      <span class=\"comment\">//console.log(that.data.city)</span></span><br><span class=\"line\">      <span class=\"comment\">//将用户的弹幕祝福信息上传服务器</span></span><br><span class=\"line\">      wx.request(&#123;</span><br><span class=\"line\">        url: <span class=\"string\">'***'</span>,</span><br><span class=\"line\">        data: &#123;</span><br><span class=\"line\">          openid: wx.getStorageSync(<span class=\"string\">\"openid\"</span>),</span><br><span class=\"line\">          color: getRandomColor(),</span><br><span class=\"line\">          display: <span class=\"literal\">true</span>,</span><br><span class=\"line\">          text: wx.getStorageSync(<span class=\"string\">'UserInfo'</span>).nickName + <span class=\"string\">'在'</span> + that.data.city + <span class=\"string\">'祝培华'</span> + that.data.danmuinfo,</span><br><span class=\"line\">          time: <span class=\"built_in\">Math</span>.ceil((<span class=\"built_in\">Math</span>.random() * <span class=\"number\">2</span>) + <span class=\"number\">15</span>),</span><br><span class=\"line\">          top: <span class=\"built_in\">Math</span>.ceil(<span class=\"built_in\">Math</span>.random() * <span class=\"number\">100</span>),</span><br><span class=\"line\">          <span class=\"keyword\">switch</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">          city: that.data.add,</span><br><span class=\"line\">          name: wx.getStorageSync(<span class=\"string\">'UserInfo'</span>).nickName</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        method: <span class=\"string\">\"POST\"</span>,</span><br><span class=\"line\">        header: &#123;</span><br><span class=\"line\">          <span class=\"string\">\"content-type\"</span>: <span class=\"string\">\"application/x-www-form-urlencoded\"</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        success: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">res</span>) </span>&#123;</span><br><span class=\"line\">          <span class=\"built_in\">console</span>.log(<span class=\"string\">\"发送弹幕成功\"</span>);</span><br><span class=\"line\">          wx.showToast(&#123;</span><br><span class=\"line\">            title: <span class=\"string\">'祝福成功'</span>,</span><br><span class=\"line\">            icon: <span class=\"string\">'success'</span>,</span><br><span class=\"line\">            duration: <span class=\"number\">2000</span></span><br><span class=\"line\">          &#125;)</span><br><span class=\"line\">          that.setData(&#123;</span><br><span class=\"line\">            senddisabled: <span class=\"literal\">true</span></span><br><span class=\"line\">          &#125;)</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        fail: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">res</span>) </span>&#123;</span><br><span class=\"line\">          <span class=\"built_in\">console</span>.log(<span class=\"string\">\"发送弹幕失败\"</span>);</span><br><span class=\"line\">          wx.showToast(&#123;</span><br><span class=\"line\">            title: <span class=\"string\">'祝福失败'</span>,</span><br><span class=\"line\">            icon: <span class=\"string\">'loading'</span>,</span><br><span class=\"line\">            duration: <span class=\"number\">2000</span></span><br><span class=\"line\">          &#125;)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">      &#125;)</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    </span><br><span class=\"line\"></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"comment\">//用户授权登陆微信</span></span><br><span class=\"line\">  onGotUserInfo: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">e</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> that = <span class=\"keyword\">this</span></span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(e.detail.errMsg)</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(e.detail.userInfo)</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(e.detail.rawData)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (e.detail.errMsg == <span class=\"string\">'getUserInfo:ok'</span>)&#123;</span><br><span class=\"line\">      wx.setStorageSync(<span class=\"string\">'UserInfo'</span>, e.detail.userInfo)</span><br><span class=\"line\">      wx.setStorageSync(<span class=\"string\">'GotUserInfo'</span>, <span class=\"literal\">true</span>)</span><br><span class=\"line\">      that.setData(&#123;</span><br><span class=\"line\">        GotUserInfohidden: <span class=\"literal\">true</span></span><br><span class=\"line\">      &#125;)</span><br><span class=\"line\">      </span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.setData(&#123;</span><br><span class=\"line\">        GotUserInfohidden: <span class=\"literal\">false</span></span><br><span class=\"line\">      &#125;)</span><br><span class=\"line\">      wx.showToast(&#123;</span><br><span class=\"line\">        title: <span class=\"string\">'请登陆！'</span>,</span><br><span class=\"line\">        icon: <span class=\"string\">'loading'</span>,</span><br><span class=\"line\">        duration: <span class=\"number\">2000</span></span><br><span class=\"line\">      &#125;)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    </span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  onShareAppMessage: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      title: <span class=\"string\">'祝福培华'</span>,</span><br><span class=\"line\">      path: <span class=\"string\">'/pages/90danmu/index'</span>,</span><br><span class=\"line\">      success: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">res</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> shareTickets = res.shareTickets;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (shareTickets.length == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">          <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        wx.getShareInfo(&#123;</span><br><span class=\"line\">          shareTicket: shareTickets[<span class=\"number\">0</span>],</span><br><span class=\"line\">          success: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">res</span>) </span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> encryptedData = res.encryptedData;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> iv = res.iv;</span><br><span class=\"line\"></span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      fail: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">res</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// 转发失败</span></span><br><span class=\"line\"></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"comment\">//卸载该页面停止计数</span></span><br><span class=\"line\">  onUnload() &#123;</span><br><span class=\"line\">    clearTimeout(<span class=\"keyword\">this</span>.data.Interval);</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">\"停止计数器\"</span>);</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.setData(&#123;</span><br><span class=\"line\">      usrdoommData: [],</span><br><span class=\"line\">      danmu: []</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"keyword\">this</span>.data.doommList)</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure></p>\n<p>index.wxml<br><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">view</span> <span class=\"attr\">class</span>=<span class=\"string\">\"doommview\"</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">block</span> <span class=\"attr\">wx:for</span>=<span class=\"string\">\"&#123;&#123;doommData&#125;&#125;\"</span> <span class=\"attr\">wx:key</span>=<span class=\"string\">\"id\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">text</span> <span class=\"attr\">wx:if</span>=<span class=\"string\">\"&#123;&#123;item.display&#125;&#125;\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"aon\"</span> <span class=\"attr\">style</span>=<span class=\"string\">\"animation: first &#123;&#123;item.time&#125;&#125;s linear forwards;top:&#123;&#123;item.top&#125;&#125;%;color:&#123;&#123;item.color&#125;&#125;;\"</span>&gt;</span></span><br><span class=\"line\">            &#123;&#123;item.text&#125;&#125;</span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">text</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">block</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">block</span> <span class=\"attr\">wx:for</span>=<span class=\"string\">\"&#123;&#123;usrdoommData&#125;&#125;\"</span> <span class=\"attr\">wx:key</span>=<span class=\"string\">\"id\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">text</span> <span class=\"attr\">wx:if</span>=<span class=\"string\">\"&#123;&#123;item.display&#125;&#125;\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"aon\"</span> <span class=\"attr\">style</span>=<span class=\"string\">\"animation: first &#123;&#123;item.time&#125;&#125;s linear forwards;top:&#123;&#123;item.top&#125;&#125;%;color:&#123;&#123;item.color&#125;&#125;;\"</span>&gt;</span></span><br><span class=\"line\">            &#123;&#123;item.text&#125;&#125;</span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">text</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">block</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">view</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">view</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-flex button\"</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">view</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-flex__item\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">view</span> <span class=\"attr\">class</span>=<span class=\"string\">\"\"</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-input placeholder\"</span> <span class=\"attr\">type</span>=<span class=\"string\">'text'</span> <span class=\"attr\">confirm-type</span>=<span class=\"string\">'send'</span> <span class=\"attr\">placeholder</span>=<span class=\"string\">\"&#123;&#123;placeholderinfo&#125;&#125;\"</span> <span class=\"attr\">name</span>=<span class=\"string\">\"xieban\"</span> <span class=\"attr\">bindconfirm</span>=<span class=\"string\">\"bindbt\"</span> <span class=\"attr\">hidden</span>=<span class=\"string\">'&#123;&#123;!GotUserInfohidden&#125;&#125;'</span> /&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-btn btn\"</span> <span class=\"attr\">type</span>=<span class=\"string\">\"primary\"</span> <span class=\"attr\">open-type</span>=<span class=\"string\">\"getUserInfo\"</span> <span class=\"attr\">lang</span>=<span class=\"string\">\"zh_CN\"</span> <span class=\"attr\">bindgetuserinfo</span>=<span class=\"string\">\"onGotUserInfo\"</span> <span class=\"attr\">hidden</span>=<span class=\"string\">'&#123;&#123;GotUserInfohidden&#125;&#125;'</span>&gt;</span>登陆<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">view</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">view</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">view</span>&gt;</span></span><br></pre></td></tr></table></figure></p>\n<p>index.wxss<br><figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">@<span class=\"keyword\">import</span> <span class=\"string\">'weui.wxss'</span>; </span><br><span class=\"line\"><span class=\"selector-class\">.button</span>&#123;</span><br><span class=\"line\">  <span class=\"attribute\">position</span>: absolute;</span><br><span class=\"line\">  <span class=\"attribute\">bottom</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">  <span class=\"attribute\">width</span>: <span class=\"number\">100%</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.aon</span>&#123;</span><br><span class=\"line\"><span class=\"attribute\">position</span>: absolute;</span><br><span class=\"line\"><span class=\"attribute\">white-space</span>:nowrap;<span class=\"comment\">/* 防止向下换行*/</span></span><br><span class=\"line\"><span class=\"attribute\">animation-timing-function</span>: linear;</span><br><span class=\"line\"><span class=\"attribute\">animation-fill-mode</span>: none;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.doommview</span>&#123;</span><br><span class=\"line\">  <span class=\"attribute\">z-index</span>: <span class=\"number\">3</span>;</span><br><span class=\"line\">  <span class=\"attribute\">height</span>: <span class=\"number\">80%</span>;</span><br><span class=\"line\">  <span class=\"attribute\">width</span>: <span class=\"number\">100%</span>;</span><br><span class=\"line\">  <span class=\"attribute\">position</span>: absolute;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">@<span class=\"keyword\">keyframes</span> first&#123;</span><br><span class=\"line\">  <span class=\"selector-tag\">from</span>&#123;<span class=\"attribute\">left</span>: <span class=\"number\">100%</span>; &#125;</span><br><span class=\"line\">  <span class=\"selector-tag\">to</span>&#123;<span class=\"attribute\">left</span>: -<span class=\"number\">100%</span>;&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.placeholder</span>&#123;</span><br><span class=\"line\">    <span class=\"attribute\">margin</span>: <span class=\"number\">10px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">padding</span>: <span class=\"number\">0</span> <span class=\"number\">10px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">text-align</span>: center;</span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: <span class=\"number\">#EBEBEB</span>;</span><br><span class=\"line\">    <span class=\"attribute\">height</span>: <span class=\"number\">40</span>prx;</span><br><span class=\"line\">    <span class=\"attribute\">line-height</span>: <span class=\"number\">40</span>prx;</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: <span class=\"number\">#434343</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.btn</span>&#123;</span><br><span class=\"line\">  <span class=\"attribute\">height</span>: <span class=\"number\">40</span>prx;</span><br><span class=\"line\">  <span class=\"attribute\">line-height</span>: <span class=\"number\">40</span>prx;</span><br><span class=\"line\">  <span class=\"attribute\">margin</span>: <span class=\"number\">10px</span>;</span><br><span class=\"line\">  <span class=\"attribute\">padding</span>: <span class=\"number\">0</span> <span class=\"number\">10px</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n","more":"<h3 id=\"想法\"><a href=\"#想法\" class=\"headerlink\" title=\"想法\"></a>想法</h3><hr>\n<p>学校校庆在即，突然有了做一个校友发送祝福的功能，正好最近复习了Js的基础，趁热打铁练练手吧。<br>因为主要的功能是发送祝福，所以不像各大直播平台的实时弹幕，这样一来也就简单的多了。<br>只需要用户发送祝福，将祝福信息存储到数据库，然后加载页面时将祝福信息列表循环 显示出来就好了。</p>\n<h3 id=\"重点\"><a href=\"#重点\" class=\"headerlink\" title=\"重点\"></a>重点</h3><hr>\n<p> 1.使用定时器和取消定时器</p>\n<p> 设置1500ms的定时：<br> <figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">this</span>.data.Interval = setInterval(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">      XXX</span><br><span class=\"line\">    &#125;, <span class=\"number\">1500</span>)</span><br></pre></td></tr></table></figure></p>\n<p>取消定时：<br> <figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">clearTimeout(<span class=\"keyword\">this</span>.data.Interval);</span><br></pre></td></tr></table></figure></p>\n<p> 2.使用腾讯地图API逆地址解析</p>\n <figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 引入SDK核心类</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> QQMapWX = <span class=\"built_in\">require</span>(<span class=\"string\">'xxx/qqmap-wx.js'</span>);</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"comment\">// 实例化API核心类</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> demo = <span class=\"keyword\">new</span> QQMapWX(&#123;</span><br><span class=\"line\">    key: <span class=\"string\">'开发密钥（key）'</span> <span class=\"comment\">// 必填</span></span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"comment\">// 调用接口</span></span><br><span class=\"line\">demo.reverseGeocoder(&#123;</span><br><span class=\"line\">    location: &#123;</span><br><span class=\"line\">        latitude: <span class=\"number\">39.984060</span>,</span><br><span class=\"line\">        longitude: <span class=\"number\">116.307520</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    success: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">res</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(res);</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    fail: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">res</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(res);</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    complete: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">res</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(res);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<h3 id=\"代码\"><a href=\"#代码\" class=\"headerlink\" title=\"代码\"></a>代码</h3><hr>\n<p>index.js<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br><span class=\"line\">245</span><br><span class=\"line\">246</span><br><span class=\"line\">247</span><br><span class=\"line\">248</span><br><span class=\"line\">249</span><br><span class=\"line\">250</span><br><span class=\"line\">251</span><br><span class=\"line\">252</span><br><span class=\"line\">253</span><br><span class=\"line\">254</span><br><span class=\"line\">255</span><br><span class=\"line\">256</span><br><span class=\"line\">257</span><br><span class=\"line\">258</span><br><span class=\"line\">259</span><br><span class=\"line\">260</span><br><span class=\"line\">261</span><br><span class=\"line\">262</span><br><span class=\"line\">263</span><br><span class=\"line\">264</span><br><span class=\"line\">265</span><br><span class=\"line\">266</span><br><span class=\"line\">267</span><br><span class=\"line\">268</span><br><span class=\"line\">269</span><br><span class=\"line\">270</span><br><span class=\"line\">271</span><br><span class=\"line\">272</span><br><span class=\"line\">273</span><br><span class=\"line\">274</span><br><span class=\"line\">275</span><br><span class=\"line\">276</span><br><span class=\"line\">277</span><br><span class=\"line\">278</span><br><span class=\"line\">279</span><br><span class=\"line\">280</span><br><span class=\"line\">281</span><br><span class=\"line\">282</span><br><span class=\"line\">283</span><br><span class=\"line\">284</span><br><span class=\"line\">285</span><br><span class=\"line\">286</span><br><span class=\"line\">287</span><br><span class=\"line\">288</span><br><span class=\"line\">289</span><br><span class=\"line\">290</span><br><span class=\"line\">291</span><br><span class=\"line\">292</span><br><span class=\"line\">293</span><br><span class=\"line\">294</span><br><span class=\"line\">295</span><br><span class=\"line\">296</span><br><span class=\"line\">297</span><br><span class=\"line\">298</span><br><span class=\"line\">299</span><br><span class=\"line\">300</span><br><span class=\"line\">301</span><br><span class=\"line\">302</span><br><span class=\"line\">303</span><br><span class=\"line\">304</span><br><span class=\"line\">305</span><br><span class=\"line\">306</span><br><span class=\"line\">307</span><br><span class=\"line\">308</span><br><span class=\"line\">309</span><br><span class=\"line\">310</span><br><span class=\"line\">311</span><br><span class=\"line\">312</span><br><span class=\"line\">313</span><br><span class=\"line\">314</span><br><span class=\"line\">315</span><br><span class=\"line\">316</span><br><span class=\"line\">317</span><br><span class=\"line\">318</span><br><span class=\"line\">319</span><br><span class=\"line\">320</span><br><span class=\"line\">321</span><br><span class=\"line\">322</span><br><span class=\"line\">323</span><br><span class=\"line\">324</span><br><span class=\"line\">325</span><br><span class=\"line\">326</span><br><span class=\"line\">327</span><br><span class=\"line\">328</span><br><span class=\"line\">329</span><br><span class=\"line\">330</span><br><span class=\"line\">331</span><br><span class=\"line\">332</span><br><span class=\"line\">333</span><br><span class=\"line\">334</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//index.js</span></span><br><span class=\"line\"><span class=\"comment\">// 引入腾讯地图SDK核心类</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> QQMapWX = <span class=\"built_in\">require</span>(<span class=\"string\">'../../utils/qqmap-wx-jssdk.js'</span>);</span><br><span class=\"line\"><span class=\"comment\">// 实例化API核心类</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> demo = <span class=\"keyword\">new</span> QQMapWX(&#123;</span><br><span class=\"line\">  key: <span class=\"string\">'****'</span> <span class=\"comment\">// 必填</span></span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"><span class=\"keyword\">const</span> app = getApp()</span><br><span class=\"line\"><span class=\"keyword\">var</span> page = <span class=\"literal\">undefined</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> doommList = [];</span><br><span class=\"line\"><span class=\"keyword\">var</span> i = <span class=\"number\">0</span>;</span><br><span class=\"line\"><span class=\"comment\">//设置数组</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Doomm</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">constructor</span>(text, top, time, color) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.text = text;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.top = top;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.time = time;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.color = color;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.display = <span class=\"literal\">true</span>;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> that = <span class=\"keyword\">this</span>;</span><br><span class=\"line\">    setTimeout(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">      doommList.splice(doommList.indexOf(that), <span class=\"number\">1</span>);</span><br><span class=\"line\">      page.setData(&#123;</span><br><span class=\"line\">        doommData: doommList,</span><br><span class=\"line\">      &#125;)</span><br><span class=\"line\">    &#125;, <span class=\"keyword\">this</span>.time * <span class=\"number\">10000</span>)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//随机颜色</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getRandomColor</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> rgb = []</span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">3</span>; ++i) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> color = <span class=\"built_in\">Math</span>.floor(<span class=\"built_in\">Math</span>.random() * <span class=\"number\">256</span>).toString(<span class=\"number\">16</span>)</span><br><span class=\"line\">    color = color.length == <span class=\"number\">1</span> ? <span class=\"string\">'0'</span> + color : color</span><br><span class=\"line\">    rgb.push(color)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"string\">'#'</span> + rgb.join(<span class=\"string\">''</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">Page(&#123;</span><br><span class=\"line\">  data: &#123;</span><br><span class=\"line\">    doommData: [],</span><br><span class=\"line\">    usrdoommData: [],</span><br><span class=\"line\">    Interval: <span class=\"string\">''</span>,</span><br><span class=\"line\">    danmuinfo: <span class=\"string\">''</span>,</span><br><span class=\"line\">    senddisabled: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    placeholderinfo: <span class=\"string\">'培华九十岁生日快乐！'</span>,</span><br><span class=\"line\">    GotUserInfohidden: <span class=\"literal\">false</span>,<span class=\"comment\">//设置登陆button隐藏</span></span><br><span class=\"line\">    city:<span class=\"string\">''</span>,<span class=\"comment\">//用户所在城市</span></span><br><span class=\"line\">    add:<span class=\"string\">''</span><span class=\"comment\">//用户地点</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  onLoad: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    page = <span class=\"keyword\">this</span>;</span><br><span class=\"line\">    wx.showShareMenu(&#123;</span><br><span class=\"line\">      withShareTicket: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    <span class=\"comment\">//获取用户坐标</span></span><br><span class=\"line\">    wx.getLocation(&#123;</span><br><span class=\"line\">      type: <span class=\"string\">'wgs84'</span>,</span><br><span class=\"line\">      success: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">res</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(res)</span><br><span class=\"line\">        <span class=\"keyword\">var</span> latitude = res.latitude</span><br><span class=\"line\">        <span class=\"keyword\">var</span> longitude = res.longitude</span><br><span class=\"line\">        <span class=\"keyword\">var</span> speed = res.speed</span><br><span class=\"line\">        <span class=\"keyword\">var</span> accuracy = res.accuracy</span><br><span class=\"line\">        <span class=\"comment\">// 调用接口反编译地点信息</span></span><br><span class=\"line\">        demo.reverseGeocoder(&#123;</span><br><span class=\"line\">          location: &#123;</span><br><span class=\"line\">            latitude: res.latitude,</span><br><span class=\"line\">            longitude: res.longitude</span><br><span class=\"line\">          &#125;,</span><br><span class=\"line\">          success: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">res</span>) </span>&#123;</span><br><span class=\"line\">            <span class=\"built_in\">console</span>.log(res.result.ad_info.city);</span><br><span class=\"line\">            page.setData(&#123;</span><br><span class=\"line\">              add: res.result,</span><br><span class=\"line\">              city: res.result.ad_info.city</span><br><span class=\"line\">            &#125;)</span><br><span class=\"line\">          &#125;,</span><br><span class=\"line\">          fail: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">res</span>) </span>&#123;</span><br><span class=\"line\">            <span class=\"built_in\">console</span>.log(res);</span><br><span class=\"line\">          &#125;,</span><br><span class=\"line\">          complete: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">res</span>) </span>&#123;</span><br><span class=\"line\">            <span class=\"built_in\">console</span>.log(res);</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      fail: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">res</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(res);</span><br><span class=\"line\">        wx.showToast(&#123;</span><br><span class=\"line\">          title: <span class=\"string\">'请使用位置访问！'</span>,</span><br><span class=\"line\">          icon: <span class=\"string\">'loading'</span>,</span><br><span class=\"line\">          duration: <span class=\"number\">2000</span></span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    wx.login(&#123;</span><br><span class=\"line\">      success: <span class=\"function\"><span class=\"params\">res</span> =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">//发送 res.code 到后台换取 openId, sessionKey, unionId</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (res.code) &#123;</span><br><span class=\"line\">          <span class=\"comment\">//console.log(res.code)</span></span><br><span class=\"line\">          <span class=\"keyword\">var</span> code = res.code; <span class=\"comment\">//返回code</span></span><br><span class=\"line\">          wx.request(&#123;</span><br><span class=\"line\">            url: <span class=\"string\">'***'</span>,</span><br><span class=\"line\">            method: <span class=\"string\">\"GET\"</span>,</span><br><span class=\"line\">            data: &#123;</span><br><span class=\"line\">              code: code</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            header: &#123;</span><br><span class=\"line\">              <span class=\"string\">'content-type'</span>: <span class=\"string\">'application/x-www-form-urlencoded'</span></span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            success: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">res</span>) </span>&#123;</span><br><span class=\"line\">              <span class=\"built_in\">console</span>.log(res.data)</span><br><span class=\"line\">              wx.setStorageSync(<span class=\"string\">\"openid\"</span>, res.data)</span><br><span class=\"line\"></span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            fail: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">res</span>) </span>&#123;</span><br><span class=\"line\">              <span class=\"comment\">//失败回调</span></span><br><span class=\"line\">              <span class=\"built_in\">console</span>.log(res)</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">          &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    <span class=\"comment\">//判断用户是否登陆</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (wx.getStorageSync(<span class=\"string\">'GotUserInfo'</span>) == <span class=\"literal\">true</span>) &#123;</span><br><span class=\"line\">      page.setData(&#123;</span><br><span class=\"line\">        GotUserInfohidden: <span class=\"literal\">true</span></span><br><span class=\"line\">      &#125;)</span><br><span class=\"line\">      <span class=\"built_in\">console</span>.log(page.data.GotUserInfohidden)</span><br><span class=\"line\">      <span class=\"built_in\">console</span>.log(wx.getStorageInfoSync(<span class=\"string\">'GotUserInfo'</span>))</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">//获取数据库弹幕</span></span><br><span class=\"line\">    wx.request(&#123;</span><br><span class=\"line\">      url: <span class=\"string\">'***'</span>,</span><br><span class=\"line\">      method: <span class=\"string\">\"GET\"</span>,</span><br><span class=\"line\">      data: &#123;</span><br><span class=\"line\">        <span class=\"keyword\">switch</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      header: &#123;</span><br><span class=\"line\">        <span class=\"string\">\"content-type\"</span>: <span class=\"string\">\"application/x-www-form-urlencoded\"</span></span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      success: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">res</span>) </span>&#123;</span><br><span class=\"line\">        page.setData(&#123;</span><br><span class=\"line\">          danmu: res.data,</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(page.data.danmu);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> arr = []</span><br><span class=\"line\">        <span class=\"keyword\">var</span> i = <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"comment\">//定时一个一个push弹幕信息</span></span><br><span class=\"line\">        page.data.Interval = setInterval(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">          <span class=\"keyword\">if</span> (i &lt; page.data.danmu.length) &#123;</span><br><span class=\"line\">            i++;</span><br><span class=\"line\">            arr.push(page.data.danmu[i])</span><br><span class=\"line\">            <span class=\"comment\">//console.log(arr);</span></span><br><span class=\"line\">            page.setData(&#123;</span><br><span class=\"line\">              doommData: arr,</span><br><span class=\"line\">            &#125;)</span><br><span class=\"line\">          &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            i = <span class=\"number\">0</span>;</span><br><span class=\"line\">            wx.request(&#123;</span><br><span class=\"line\">              url: <span class=\"string\">'***'</span>,</span><br><span class=\"line\">              method: <span class=\"string\">\"GET\"</span>,</span><br><span class=\"line\">              data: &#123;</span><br><span class=\"line\">                <span class=\"keyword\">switch</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">              &#125;,</span><br><span class=\"line\">              header: &#123;</span><br><span class=\"line\">                <span class=\"string\">\"content-type\"</span>: <span class=\"string\">\"application/x-www-form-urlencoded\"</span></span><br><span class=\"line\">              &#125;,</span><br><span class=\"line\">              success: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">res</span>) </span>&#123;</span><br><span class=\"line\">                page.setData(&#123;</span><br><span class=\"line\">                  danmu: res.data,</span><br><span class=\"line\">                &#125;)</span><br><span class=\"line\">              &#125;,</span><br><span class=\"line\">              fail: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">res</span>) </span>&#123;</span><br><span class=\"line\">                <span class=\"built_in\">console</span>.log(res);</span><br><span class=\"line\">              &#125;</span><br><span class=\"line\">            &#125;)</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">          <span class=\"built_in\">console</span>.log(i)</span><br><span class=\"line\">        &#125;, <span class=\"number\">1500</span>)</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      fail: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">res</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(res);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"comment\">//发送弹幕祝福</span></span><br><span class=\"line\">  bindbt: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">e</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(e.detail.value)</span><br><span class=\"line\">    <span class=\"comment\">//当input失去焦点则调用函数发送</span></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.setData(&#123;</span><br><span class=\"line\">      danmuinfo: e.detail.value</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.data.danmuinfo !== <span class=\"string\">''</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.setData(&#123;</span><br><span class=\"line\">        senddisabled: <span class=\"literal\">false</span></span><br><span class=\"line\">      &#125;)</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.send();</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.setData(&#123;</span><br><span class=\"line\">        senddisabled: <span class=\"literal\">true</span></span><br><span class=\"line\">      &#125;)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  send: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">e</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> that = <span class=\"keyword\">this</span>;</span><br><span class=\"line\">    <span class=\"comment\">//console.log(that.data.add)</span></span><br><span class=\"line\">    <span class=\"comment\">//console.log(that.data.city)</span></span><br><span class=\"line\">    <span class=\"comment\">//如果弹幕不为空则将弹幕祝福push数组并赋给usrdoommData，显示用户当前发送弹幕祝福信息</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (that.data.danmuinfo !== <span class=\"string\">''</span>) &#123;</span><br><span class=\"line\">      doommList.push(<span class=\"keyword\">new</span> Doomm(wx.getStorageSync(<span class=\"string\">'UserInfo'</span>).nickName + <span class=\"string\">'在'</span> + that.data.city + <span class=\"string\">'祝培华'</span> + that.data.danmuinfo, <span class=\"built_in\">Math</span>.ceil(<span class=\"built_in\">Math</span>.random() * <span class=\"number\">100</span>), <span class=\"built_in\">Math</span>.ceil((<span class=\"built_in\">Math</span>.random() * <span class=\"number\">2</span>) + <span class=\"number\">15</span>), <span class=\"string\">'#000000'</span>));</span><br><span class=\"line\">      that.setData(&#123;</span><br><span class=\"line\">        usrdoommData: doommList,</span><br><span class=\"line\">      &#125;)</span><br><span class=\"line\">      <span class=\"built_in\">console</span>.log(doommList);</span><br><span class=\"line\">      <span class=\"comment\">//console.log(that.data.city)</span></span><br><span class=\"line\">      <span class=\"comment\">//将用户的弹幕祝福信息上传服务器</span></span><br><span class=\"line\">      wx.request(&#123;</span><br><span class=\"line\">        url: <span class=\"string\">'***'</span>,</span><br><span class=\"line\">        data: &#123;</span><br><span class=\"line\">          openid: wx.getStorageSync(<span class=\"string\">\"openid\"</span>),</span><br><span class=\"line\">          color: getRandomColor(),</span><br><span class=\"line\">          display: <span class=\"literal\">true</span>,</span><br><span class=\"line\">          text: wx.getStorageSync(<span class=\"string\">'UserInfo'</span>).nickName + <span class=\"string\">'在'</span> + that.data.city + <span class=\"string\">'祝培华'</span> + that.data.danmuinfo,</span><br><span class=\"line\">          time: <span class=\"built_in\">Math</span>.ceil((<span class=\"built_in\">Math</span>.random() * <span class=\"number\">2</span>) + <span class=\"number\">15</span>),</span><br><span class=\"line\">          top: <span class=\"built_in\">Math</span>.ceil(<span class=\"built_in\">Math</span>.random() * <span class=\"number\">100</span>),</span><br><span class=\"line\">          <span class=\"keyword\">switch</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">          city: that.data.add,</span><br><span class=\"line\">          name: wx.getStorageSync(<span class=\"string\">'UserInfo'</span>).nickName</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        method: <span class=\"string\">\"POST\"</span>,</span><br><span class=\"line\">        header: &#123;</span><br><span class=\"line\">          <span class=\"string\">\"content-type\"</span>: <span class=\"string\">\"application/x-www-form-urlencoded\"</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        success: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">res</span>) </span>&#123;</span><br><span class=\"line\">          <span class=\"built_in\">console</span>.log(<span class=\"string\">\"发送弹幕成功\"</span>);</span><br><span class=\"line\">          wx.showToast(&#123;</span><br><span class=\"line\">            title: <span class=\"string\">'祝福成功'</span>,</span><br><span class=\"line\">            icon: <span class=\"string\">'success'</span>,</span><br><span class=\"line\">            duration: <span class=\"number\">2000</span></span><br><span class=\"line\">          &#125;)</span><br><span class=\"line\">          that.setData(&#123;</span><br><span class=\"line\">            senddisabled: <span class=\"literal\">true</span></span><br><span class=\"line\">          &#125;)</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        fail: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">res</span>) </span>&#123;</span><br><span class=\"line\">          <span class=\"built_in\">console</span>.log(<span class=\"string\">\"发送弹幕失败\"</span>);</span><br><span class=\"line\">          wx.showToast(&#123;</span><br><span class=\"line\">            title: <span class=\"string\">'祝福失败'</span>,</span><br><span class=\"line\">            icon: <span class=\"string\">'loading'</span>,</span><br><span class=\"line\">            duration: <span class=\"number\">2000</span></span><br><span class=\"line\">          &#125;)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">      &#125;)</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    </span><br><span class=\"line\"></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"comment\">//用户授权登陆微信</span></span><br><span class=\"line\">  onGotUserInfo: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">e</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> that = <span class=\"keyword\">this</span></span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(e.detail.errMsg)</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(e.detail.userInfo)</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(e.detail.rawData)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (e.detail.errMsg == <span class=\"string\">'getUserInfo:ok'</span>)&#123;</span><br><span class=\"line\">      wx.setStorageSync(<span class=\"string\">'UserInfo'</span>, e.detail.userInfo)</span><br><span class=\"line\">      wx.setStorageSync(<span class=\"string\">'GotUserInfo'</span>, <span class=\"literal\">true</span>)</span><br><span class=\"line\">      that.setData(&#123;</span><br><span class=\"line\">        GotUserInfohidden: <span class=\"literal\">true</span></span><br><span class=\"line\">      &#125;)</span><br><span class=\"line\">      </span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.setData(&#123;</span><br><span class=\"line\">        GotUserInfohidden: <span class=\"literal\">false</span></span><br><span class=\"line\">      &#125;)</span><br><span class=\"line\">      wx.showToast(&#123;</span><br><span class=\"line\">        title: <span class=\"string\">'请登陆！'</span>,</span><br><span class=\"line\">        icon: <span class=\"string\">'loading'</span>,</span><br><span class=\"line\">        duration: <span class=\"number\">2000</span></span><br><span class=\"line\">      &#125;)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    </span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  onShareAppMessage: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      title: <span class=\"string\">'祝福培华'</span>,</span><br><span class=\"line\">      path: <span class=\"string\">'/pages/90danmu/index'</span>,</span><br><span class=\"line\">      success: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">res</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> shareTickets = res.shareTickets;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (shareTickets.length == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">          <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        wx.getShareInfo(&#123;</span><br><span class=\"line\">          shareTicket: shareTickets[<span class=\"number\">0</span>],</span><br><span class=\"line\">          success: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">res</span>) </span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> encryptedData = res.encryptedData;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> iv = res.iv;</span><br><span class=\"line\"></span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      fail: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">res</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// 转发失败</span></span><br><span class=\"line\"></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"comment\">//卸载该页面停止计数</span></span><br><span class=\"line\">  onUnload() &#123;</span><br><span class=\"line\">    clearTimeout(<span class=\"keyword\">this</span>.data.Interval);</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">\"停止计数器\"</span>);</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.setData(&#123;</span><br><span class=\"line\">      usrdoommData: [],</span><br><span class=\"line\">      danmu: []</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"keyword\">this</span>.data.doommList)</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure></p>\n<p>index.wxml<br><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">view</span> <span class=\"attr\">class</span>=<span class=\"string\">\"doommview\"</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">block</span> <span class=\"attr\">wx:for</span>=<span class=\"string\">\"&#123;&#123;doommData&#125;&#125;\"</span> <span class=\"attr\">wx:key</span>=<span class=\"string\">\"id\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">text</span> <span class=\"attr\">wx:if</span>=<span class=\"string\">\"&#123;&#123;item.display&#125;&#125;\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"aon\"</span> <span class=\"attr\">style</span>=<span class=\"string\">\"animation: first &#123;&#123;item.time&#125;&#125;s linear forwards;top:&#123;&#123;item.top&#125;&#125;%;color:&#123;&#123;item.color&#125;&#125;;\"</span>&gt;</span></span><br><span class=\"line\">            &#123;&#123;item.text&#125;&#125;</span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">text</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">block</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">block</span> <span class=\"attr\">wx:for</span>=<span class=\"string\">\"&#123;&#123;usrdoommData&#125;&#125;\"</span> <span class=\"attr\">wx:key</span>=<span class=\"string\">\"id\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">text</span> <span class=\"attr\">wx:if</span>=<span class=\"string\">\"&#123;&#123;item.display&#125;&#125;\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"aon\"</span> <span class=\"attr\">style</span>=<span class=\"string\">\"animation: first &#123;&#123;item.time&#125;&#125;s linear forwards;top:&#123;&#123;item.top&#125;&#125;%;color:&#123;&#123;item.color&#125;&#125;;\"</span>&gt;</span></span><br><span class=\"line\">            &#123;&#123;item.text&#125;&#125;</span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">text</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">block</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">view</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">view</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-flex button\"</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">view</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-flex__item\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">view</span> <span class=\"attr\">class</span>=<span class=\"string\">\"\"</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-input placeholder\"</span> <span class=\"attr\">type</span>=<span class=\"string\">'text'</span> <span class=\"attr\">confirm-type</span>=<span class=\"string\">'send'</span> <span class=\"attr\">placeholder</span>=<span class=\"string\">\"&#123;&#123;placeholderinfo&#125;&#125;\"</span> <span class=\"attr\">name</span>=<span class=\"string\">\"xieban\"</span> <span class=\"attr\">bindconfirm</span>=<span class=\"string\">\"bindbt\"</span> <span class=\"attr\">hidden</span>=<span class=\"string\">'&#123;&#123;!GotUserInfohidden&#125;&#125;'</span> /&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-btn btn\"</span> <span class=\"attr\">type</span>=<span class=\"string\">\"primary\"</span> <span class=\"attr\">open-type</span>=<span class=\"string\">\"getUserInfo\"</span> <span class=\"attr\">lang</span>=<span class=\"string\">\"zh_CN\"</span> <span class=\"attr\">bindgetuserinfo</span>=<span class=\"string\">\"onGotUserInfo\"</span> <span class=\"attr\">hidden</span>=<span class=\"string\">'&#123;&#123;GotUserInfohidden&#125;&#125;'</span>&gt;</span>登陆<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">view</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">view</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">view</span>&gt;</span></span><br></pre></td></tr></table></figure></p>\n<p>index.wxss<br><figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">@<span class=\"keyword\">import</span> <span class=\"string\">'weui.wxss'</span>; </span><br><span class=\"line\"><span class=\"selector-class\">.button</span>&#123;</span><br><span class=\"line\">  <span class=\"attribute\">position</span>: absolute;</span><br><span class=\"line\">  <span class=\"attribute\">bottom</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">  <span class=\"attribute\">width</span>: <span class=\"number\">100%</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.aon</span>&#123;</span><br><span class=\"line\"><span class=\"attribute\">position</span>: absolute;</span><br><span class=\"line\"><span class=\"attribute\">white-space</span>:nowrap;<span class=\"comment\">/* 防止向下换行*/</span></span><br><span class=\"line\"><span class=\"attribute\">animation-timing-function</span>: linear;</span><br><span class=\"line\"><span class=\"attribute\">animation-fill-mode</span>: none;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.doommview</span>&#123;</span><br><span class=\"line\">  <span class=\"attribute\">z-index</span>: <span class=\"number\">3</span>;</span><br><span class=\"line\">  <span class=\"attribute\">height</span>: <span class=\"number\">80%</span>;</span><br><span class=\"line\">  <span class=\"attribute\">width</span>: <span class=\"number\">100%</span>;</span><br><span class=\"line\">  <span class=\"attribute\">position</span>: absolute;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">@<span class=\"keyword\">keyframes</span> first&#123;</span><br><span class=\"line\">  <span class=\"selector-tag\">from</span>&#123;<span class=\"attribute\">left</span>: <span class=\"number\">100%</span>; &#125;</span><br><span class=\"line\">  <span class=\"selector-tag\">to</span>&#123;<span class=\"attribute\">left</span>: -<span class=\"number\">100%</span>;&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.placeholder</span>&#123;</span><br><span class=\"line\">    <span class=\"attribute\">margin</span>: <span class=\"number\">10px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">padding</span>: <span class=\"number\">0</span> <span class=\"number\">10px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">text-align</span>: center;</span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: <span class=\"number\">#EBEBEB</span>;</span><br><span class=\"line\">    <span class=\"attribute\">height</span>: <span class=\"number\">40</span>prx;</span><br><span class=\"line\">    <span class=\"attribute\">line-height</span>: <span class=\"number\">40</span>prx;</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: <span class=\"number\">#434343</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.btn</span>&#123;</span><br><span class=\"line\">  <span class=\"attribute\">height</span>: <span class=\"number\">40</span>prx;</span><br><span class=\"line\">  <span class=\"attribute\">line-height</span>: <span class=\"number\">40</span>prx;</span><br><span class=\"line\">  <span class=\"attribute\">margin</span>: <span class=\"number\">10px</span>;</span><br><span class=\"line\">  <span class=\"attribute\">padding</span>: <span class=\"number\">0</span> <span class=\"number\">10px</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n","categories":[],"tags":[{"name":"微信小程序","path":"api/tags/微信小程序.json"}]}